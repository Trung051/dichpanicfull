<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dịch panicfull vip pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .header h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }
        
        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin: 0 10px;
            animation: pulse 2s infinite;
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .upload-section {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }
        
        .upload-section:hover {
            transform: translateY(-5px);
        }
        
        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8f9ff, #fff5f8);
        }
        
        .upload-zone:hover {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            border-color: #38a169;
            transform: scale(1.02);
        }
        
        .image-upload-zone {
            border: 3px dashed #f093fb;
            border-radius: 20px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #fff0fd, #fdf2f8);
        }
        
        .image-upload-zone:hover {
            background: linear-gradient(135deg, #fdf2f8, #fef7ff);
            border-color: #e879f9;
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(240, 147, 251, 0.3);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.5);
        }
        
        .ai-btn {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 0 15px 30px rgba(240, 147, 251, 0.4);
        }
        
        .search-box {
            width: 100%;
            padding: 18px 25px;
            border: 2px solid #e2e8f0;
            border-radius: 30px;
            font-size: 1.1em;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8f9ff, #fff5f8);
        }
        
        .search-box:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
        }
        
        .category-btn {
            background: linear-gradient(135deg, #f7fafc, #edf2f7);
            color: #4a5568;
            border: 2px solid #e2e8f0;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .category-btn:hover, .category-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .error-database {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9ff, #fff5f8);
        }
        
        .error-item {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .error-item:hover {
            background: linear-gradient(135deg, #e6fffa, #f0fff4);
            transform: translateX(10px);
        }
        
        .results-container {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            display: none;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .panic-analysis {
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
            border-left: 5px solid #e53e3e;
            padding: 30px;
            margin: 25px 0;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .panic-analysis::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #e53e3e, #fc8181, #feb2b2);
        }
        
        .error-category {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .severity-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .severity-critical { background: #e53e3e; }
        .severity-high { background: #dd6b20; }
        .severity-medium { background: #d69e2e; }
        .severity-low { background: #38a169; }
        
        .ai-processing {
            display: none;
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f0fff4, #c6f6d5);
            border-radius: 20px;
            margin: 20px 0;
        }
        
        .ai-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .confidence-meter {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .confidence-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #38a169, #48bb78);
            border-radius: 4px;
            transition: width 1s ease;
        }
        
        .floating-action {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .floating-action:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.5);
        }
        
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Dịch Pacnicfull</h1>
        </div>
        
        <div class="main-grid">
            <!-- Upload File Text -->
            <div class="upload-section">
                <h3 style="margin-bottom: 20px;">📄 File Text/Log</h3>
                <div class="upload-zone" id="textUploadZone">
                    <input type="file" id="textFileInput" style="display: none" accept=".txt,.crash,.ips,.panic-full,.log" multiple>
                    <div style="font-size: 3em; margin-bottom: 15px;">📱</div>
                    <h4>Kéo Thả File Log</h4>
                    <p style="margin: 10px 0; color: #666;">Hỗ trợ: txt, crash, ips, panic-full, log</p>
                    <button class="btn" onclick="document.getElementById('textFileInput').click()">Chọn File</button>
                </div>
                
                <div style="margin-top: 25px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #f0fff4; border-radius: 15px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #38a169;" id="textFiles">0</div>
                            <div style="font-size: 0.9em; color: #666;">File Text</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #fff5f5; border-radius: 15px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #e53e3e;" id="textErrors">0</div>
                            <div style="font-size: 0.9em; color: #666;">Lỗi Tìm Thấy</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Upload Ảnh với AI Vision -->
            <div class="upload-section">
                <h3 style="margin-bottom: 20px;">📸 Phân Tích AI Vision</h3>
                <div class="image-upload-zone" id="imageUploadZone">
                    <input type="file" id="imageFileInput" style="display: none" accept="image/*" multiple>
                    <div style="font-size: 3em; margin-bottom: 15px;">🤖👁️</div>
                    <h4>Dịch panic full bằng ảnh</h4>
                    <p style="margin: 10px 0; color: #666;">jpg, png, heic, webp</p>
                    <button class="btn ai-btn" onclick="document.getElementById('imageFileInput').click()">Tải Ảnh Lên</button>
                </div>
                
                <div class="ai-processing" id="aiProcessing">
                    <div class="ai-spinner"></div>
                    <h4>🧠 AI Đang Xử Lý...</h4>
                    <p>Phân tích ảnh với OCR + Nhận dạng mẫu nâng cao</p>
                </div>
                
                <div style="margin-top: 25px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #fdf2f8; border-radius: 15px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #f093fb;" id="imageFiles">0</div>
                            <div style="font-size: 0.9em; color: #666;">Ảnh</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f0f9ff; border-radius: 15px;">
                            <div style="font-size: 1.8em; font-weight: bold; color: #3b82f6;" id="aiAccuracy">0%</div>
                            <div style="font-size: 0.9em; color: #666;">Độ Chính Xác AI</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tìm Kiếm Thông Minh -->
            <div class="upload-section">
                <h3 style="margin-bottom: 20px;">🔍 Tìm Kiếm Lỗi Thông Minh</h3>
                <input type="text" class="search-box" id="searchBox" placeholder="Tìm kiếm 100+ lỗi (watchdog, thermal, panic...)">
                
                <div class="category-filter">
                    <div class="category-btn active" onclick="filterByCategory('all')">Tất Cả</div>
                    <div class="category-btn" onclick="filterByCategory('hardware')">Phần Cứng</div>
                    <div class="category-btn" onclick="filterByCategory('software')">Phần Mềm</div>
                    <div class="category-btn" onclick="filterByCategory('thermal')">Nhiệt Độ</div>
                    <div class="category-btn" onclick="filterByCategory('power')">Nguồn</div>
                    <div class="category-btn" onclick="filterByCategory('memory')">Bộ Nhớ</div>
                </div>
                
                <div class="error-database" id="errorDatabase">
                    <div style="text-align: center; color: #666; padding: 30px;">
                        <div style="font-size: 2em; margin-bottom: 10px;">🤖</div>
                        <p>AI sẵn sàng phân tích 100+ mẫu lỗi</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <h3 style="margin-bottom: 30px;">📊 Kết Quả Phân Tích AI</h3>
            <div id="analysisResults"></div>
        </div>
    </div>

    <script>
        // Cơ sở dữ liệu 100+ lỗi iOS panic log
        const errorDatabase = {
            // === LỖI PHẦN CỨNG CHI TIẾT ===
            
            "watchdog_timeout": {
                category: "hardware",
                severity: "critical",
                description: "Lỗi Watchdog timeout - CPU hoặc hệ thống không phản hồi trong thời gian quy định",
                patterns: ["watchdog timeout", "WDOG", "no checkin", "hang", "watchdog_timeout"],
                vietnameseName: "Lỗi Watchdog Timeout",
                component: "Main Logic Board - CPU/SoC",
                location: "A-series Processor (A12/A13/A14/A15/A16)",
                symptoms: ["Máy đột ngột restart", "Màn hình đen", "Không phản hồi", "Treo máy"],
                causes: ["CPU overload", "Infinite loop trong kernel", "Hardware deadlock", "Power management issue"],
                diagnosis: {
                    step1: "Kiểm tra nhiệt độ CPU bằng 3uTools",
                    step2: "Test RAM bằng MemTest",
                    step3: "Kiểm tra nguồn cấp cho CPU (PPVDD_MAIN)",
                    step4: "Đo điện trở các tụ lọc nguồn CPU"
                },
                repairSolution: ["Thay IC nguồn CPU", "Reballing CPU", "Thay tụ lọc nguồn", "Thay main board"]
            },

            "thermal_shutdown": {
                category: "thermal",
                severity: "critical", 
                description: "Thiết bị tự động tắt do nhiệt độ quá cao, bảo vệ linh kiện khỏi hư hỏng",
                patterns: ["thermal", "overtemp", "hot", "temperature", "thermal_shutdown", "thermal trap"],
                vietnameseName: "Tắt Máy Do Quá Nhiệt",
                component: "Thermal Management System",
                location: "CPU/GPU/PMU Temperature Sensors",
                symptoms: ["Máy nóng bất thường", "Tự động tắt", "Hiệu năng giảm", "Pin tụt nhanh"],
                causes: ["Thermal paste khô", "Tản nhiệt bị tắc", "Quạt hỏng", "Sensor nhiệt độ lỗi"],
                diagnosis: {
                    step1: "Đo nhiệt độ bằng thermal camera",
                    step2: "Kiểm tra thermal paste CPU/GPU",
                    step3: "Test thermal sensor bằng DC Power Supply",
                    step4: "Kiểm tra thermal throttling trong log"
                },
                repairSolution: ["Thay thermal paste", "Vệ sinh tản nhiệt", "Thay thermal sensor", "Cải thiện luồng khí"]
            },

            "battery_panic": {
                category: "power",
                severity: "high",
                description: "Lỗi liên quan đến pin và hệ thống nguồn, có thể do pin hỏng hoặc mạch sạc",
                patterns: ["battery", "power", "charging", "PMU", "battery_panic", "fuel gauge"],
                vietnameseName: "Lỗi Pin/Nguồn",
                component: "Battery Management System + PMU IC",
                location: "Logic Board - Power Management Section",
                symptoms: ["Không sạc pin", "Pin tụt nhanh", "Báo sai % pin", "Tắt máy đột ngột"],
                causes: ["Pin chai/phồng", "IC sạc hỏng", "Cảm biến pin lỗi", "Mạch nguồn chập"],
                diagnosis: {
                    step1: "Đo voltage pin (3.7V nominal)",
                    step2: "Test dòng sạc bằng USB meter",
                    step3: "Kiểm tra IC sạc U2 (Tristar)",
                    step4: "Đo điện trở internal resistance pin"
                },
                repairSolution: ["Thay pin mới", "Thay IC sạc U2", "Sửa mạch nguồn", "Thay PMU IC"]
            },

            "memory_panic": {
                category: "memory",
                severity: "high",
                description: "Lỗi bộ nhớ RAM hoặc storage, có thể do RAM hỏng hoặc lỗi dữ liệu",
                patterns: ["memory", "RAM", "ECC", "DRAM", "memory_panic", "memory corruption"],
                vietnameseName: "Lỗi Bộ Nhớ RAM",
                component: "LPDDR4/LPDDR5 RAM Modules",
                location: "Logic Board - Memory Section (stacked on SoC)",
                symptoms: ["App crash liên tục", "Restart random", "Lỗi khi mở app nặng", "iOS lag"],
                causes: ["RAM bị lỗi", "Solder joints lỏng", "Nhiệt độ cao", "Voltage không ổn định"],
                diagnosis: {
                    step1: "Chạy memory test với checkra1n",
                    step2: "Kiểm tra temperature RAM",
                    step3: "Đo voltage cấp cho RAM (VDD_MEM)",
                    step4: "Test stress với benchmark app"
                },
                repairSolution: ["Reballing RAM", "Thay RAM module", "Sửa mạch nguồn RAM", "Thay main board"]
            },

            "nand_panic": {
                category: "hardware",
                severity: "critical",
                description: "Lỗi bộ nhớ NAND flash storage, thường do wear leveling hoặc bad block",
                patterns: ["NAND", "flash", "storage", "ANS2", "nand_panic", "storage controller"],
                vietnameseName: "Lỗi Bộ Nhớ NAND Flash",
                component: "NAND Flash Storage + Storage Controller",
                location: "Logic Board - Storage Section",
                symptoms: ["Không boot được", "Lỗi restore", "Mất dữ liệu", "iOS corrupt"],
                causes: ["Bad blocks quá nhiều", "Controller hỏng", "Firmware corrupt", "Wear leveling fail"],
                diagnosis: {
                    step1: "Scan bad blocks bằng NAND programmer",
                    step2: "Kiểm tra storage controller",
                    step3: "Test read/write speed",
                    step4: "Dump firmware để check corruption"
                },
                repairSolution: ["Thay NAND flash mới", "Repair bad blocks", "Reflash firmware", "Data recovery"]
            },

            "camera_panic": {
                category: "hardware",
                severity: "medium",
                description: "Lỗi camera module hoặc ISP (Image Signal Processor)",
                patterns: ["camera", "ISP", "H11", "H13", "camera_panic", "image sensor"],
                vietnameseName: "Lỗi Camera/ISP",
                component: "Camera Module + ISP (Image Signal Processor)",
                location: "Rear/Front Camera Assembly",
                symptoms: ["Camera app crash", "Ảnh đen", "Không focus", "Lỗi flash"],
                causes: ["Camera module hỏng", "Flex cable lỏng", "ISP lỗi", "OIS actuator stuck"],
                diagnosis: {
                    step1: "Test từng camera riêng lẻ",
                    step2: "Kiểm tra flex cable camera",
                    step3: "Đo voltage cấp cho camera (AVDD/DVDD)",
                    step4: "Test ISP communication"
                },
                repairSolution: ["Thay camera module", "Thay flex cable", "Sửa mạch nguồn camera", "Thay ISP IC"]
            },

            "touch_panic": {
                category: "hardware",
                severity: "medium",
                description: "Lỗi cảm ứng touchscreen, có thể do digitizer hoặc touch IC hỏng",
                patterns: ["touch", "multitouch", "digitizer", "touch_panic", "touch controller"],
                vietnameseName: "Lỗi Cảm Ứng Touch",
                component: "Touch Controller IC + Digitizer",
                location: "Logic Board - Touch IC Section + Display Assembly",
                symptoms: ["Cảm ứng không hoạt động", "Ghost touch", "Dead zone", "Multi-touch lỗi"],
                causes: ["Touch IC hỏng", "Digitizer crack", "Flex cable lỗi", "ESD damage"],
                diagnosis: {
                    step1: "Test cảm ứng bằng diagnostic mode",
                    step2: "Kiểm tra touch IC (Meson/Broadcom)",
                    step3: "Đo voltage touch rails",
                    step4: "Test continuity flex cable"
                },
                repairSolution: ["Thay touch IC", "Thay màn hình", "Sửa flex cable", "ESD protection repair"]
            },

            "wifi_panic": {
                category: "hardware",
                severity: "medium",
                description: "Lỗi WiFi module, có thể do chip WiFi hỏng hoặc anten bị lỗi",
                patterns: ["wifi", "wlan", "802.11", "wifi_panic", "wireless"],
                vietnameseName: "Lỗi WiFi Module",
                component: "WiFi/Bluetooth Combo Chip + Antenna",
                location: "Logic Board - RF Section + Antenna Assembly",
                                symptoms: ["Không bắt được WiFi", "WiFi yếu", "Disconnect liên tục", "Không tìm thấy network"],
                causes: ["WiFi chip hỏng", "Antenna đứt", "RF shield lỏng", "Firmware corrupt"],
                diagnosis: {
                    step1: "Scan WiFi networks xung quanh",
                    step2: "Test WiFi chip communication",
                    step3: "Kiểm tra antenna continuity",
                    step4: "Đo RF power output"
                },
                repairSolution: ["Thay WiFi chip", "Sửa/thay antenna", "Reballing RF IC", "Update firmware"]
            },

            "bluetooth_panic": {
                category: "hardware",
                severity: "low",
                description: "Lỗi Bluetooth module, thường do chip Bluetooth hoặc driver bị lỗi",
                patterns: ["bluetooth", "BT", "wireless", "bluetooth_panic"],
                vietnameseName: "Lỗi Bluetooth",
                component: "Bluetooth Controller (integrated with WiFi)",
                location: "WiFi/BT Combo Chip",
                symptoms: ["Không pair được", "Audio stuttering", "Disconnect", "Không tìm thấy devices"],
                causes: ["BT firmware lỗi", "Antenna issue", "Power management", "Interference"],
                diagnosis: {
                    step1: "Test Bluetooth pairing",
                    step2: "Check BT firmware version",
                    step3: "Test audio codec",
                    step4: "Scan for interference"
                },
                repairSolution: ["Update BT firmware", "Thay WiFi/BT chip", "Antenna repair", "RF shielding"]
            },

            "accelerometer_panic": {
                category: "sensor",
                severity: "low",
                description: "Lỗi cảm biến gia tốc, có thể do cảm biến hỏng hoặc lỗi calibration",
                patterns: ["accelerometer", "motion", "gyro", "accelerometer_panic"],
                vietnameseName: "Lỗi Cảm Biến Gia Tốc",
                component: "Accelerometer/Gyroscope Sensor IC",
                location: "Logic Board - Sensor Array",
                symptoms: ["Xoay màn hình không hoạt động", "Game motion lỗi", "Compass sai", "Shake không work"],
                causes: ["Sensor IC hỏng", "Calibration sai", "Mechanical damage", "Software bug"],
                diagnosis: {
                    step1: "Test sensor trong Settings > Privacy",
                    step2: "Calibrate accelerometer",
                    step3: "Kiểm tra sensor IC",
                    step4: "Test với motion apps"
                },
                repairSolution: ["Recalibrate sensor", "Thay sensor IC", "Software reset", "Logic board repair"]
            },

            // === LỖI PHẦN MỀM CHI TIẾT ===
            "kernel_panic": {
                category: "software",
                severity: "critical",
                description: "Kernel panic - Lỗi nghiêm trọng của hệ điều hành iOS",
                patterns: ["kernel panic", "KP", "system crash", "kernel_panic"],
                vietnameseName: "Lỗi Kernel Panic",
                component: "iOS Kernel (XNU)",
                location: "System Software Level",
                symptoms: ["Restart đột ngột", "Màn hình xanh", "Freeze hoàn toàn", "Boot loop"],
                causes: ["Driver conflict", "Memory corruption", "Hardware failure", "Jailbreak tweak"],
                diagnosis: {
                    step1: "Phân tích panic log chi tiết",
                    step2: "Kiểm tra recent installs",
                    step3: "Test safe mode",
                    step4: "Hardware diagnostic"
                },
                repairSolution: ["iOS restore", "Remove jailbreak", "Hardware repair", "Factory reset"]
            },

            "springboard_crash": {
                category: "software",
                severity: "high",
                description: "SpringBoard crash - Giao diện chính iOS bị crash",
                patterns: ["SpringBoard", "backboardd", "frontboard", "springboard_crash"],
                vietnameseName: "Lỗi SpringBoard",
                component: "SpringBoard Process",
                location: "iOS User Interface Layer",
                symptoms: ["Home screen crash", "Icons biến mất", "Wallpaper đen", "Touch không response"],
                causes: ["Memory leak", "Corrupt preferences", "Bad tweak", "iOS bug"],
                diagnosis: {
                    step1: "Check SpringBoard crash logs",
                    step2: "Reset home screen layout",
                    step3: "Clear cache và temp files",
                    step4: "Disable tweaks nếu có JB"
                },
                repairSolution: ["Reset settings", "Clear SpringBoard cache", "iOS update", "Remove problematic apps"]
            },

            // === LỖI NHIỆT ĐỘ CHI TIẾT ===
            "cpu_thermal": {
                category: "thermal",
                severity: "high",
                description: "CPU quá nhiệt, hệ thống tự động throttle để bảo vệ",
                patterns: ["CPU thermal", "processor hot", "thermal throttle", "cpu_thermal"],
                vietnameseName: "CPU Quá Nhiệt",
                component: "A-series SoC (CPU cores)",
                location: "Main Processor Package",
                symptoms: ["Máy chậm đột ngột", "App lag", "Frame drop", "Máy nóng"],
                causes: ["Thermal paste khô", "Dust buildup", "High CPU usage", "Cooling system fail"],
                diagnosis: {
                    step1: "Monitor CPU temperature real-time",
                    step2: "Check thermal throttling logs",
                    step3: "Inspect thermal paste condition",
                    step4: "Test under load"
                },
                repairSolution: ["Replace thermal paste", "Clean cooling system", "Reduce CPU load", "Improve ventilation"]
            },

            "gpu_thermal": {
                category: "thermal",
                severity: "high",
                description: "GPU quá nhiệt khi xử lý đồ họa nặng",
                patterns: ["GPU thermal", "graphics hot", "GPU throttle", "gpu_thermal"],
                vietnameseName: "GPU Quá Nhiệt",
                component: "GPU (integrated in SoC)",
                location: "Graphics Processing Unit",
                symptoms: ["Game lag", "Graphics glitch", "3D app crash", "Rendering slow"],
                causes: ["Heavy graphics load", "Poor thermal design", "Dust accumulation", "Thermal paste degraded"],
                diagnosis: {
                    step1: "Run GPU stress test",
                    step2: "Monitor GPU temperature",
                    step3: "Check graphics performance",
                    step4: "Thermal imaging"
                },
                repairSolution: ["Thermal management", "Reduce graphics quality", "Clean thermal system", "Hardware upgrade"]
            },

            // === LỖI NGUỒN CHI TIẾT ===
            "pmu_panic": {
                category: "power",
                severity: "critical",
                description: "Power Management Unit panic - Lỗi IC quản lý nguồn",
                patterns: ["PMU", "power management", "PMIC", "pmu_panic"],
                vietnameseName: "Lỗi IC Quản Lý Nguồn (PMU)",
                component: "Power Management IC (PMU)",
                location: "Logic Board - Power Section",
                symptoms: ["Không lên nguồn", "Nguồn không ổn định", "Random shutdown", "Charging issues"],
                causes: ["PMU IC failure", "Power rail short", "Voltage regulator damage", "Overcurrent protection"],
                diagnosis: {
                    step1: "Đo các rail nguồn chính",
                    step2: "Kiểm tra PMU communication",
                    step3: "Test power sequencing",
                    step4: "Check for shorts"
                },
                repairSolution: ["Thay PMU IC", "Repair power rails", "Fix short circuits", "Replace power components"]
            },

            "charging_panic": {
                category: "power",
                severity: "medium",
                description: "Lỗi sạc pin, có thể do cáp sạc hoặc IC sạc hỏng",
                patterns: ["charging", "charger", "USB-C", "lightning", "charging_panic"],
                vietnameseName: "Lỗi Sạc Pin",
                component: "Charging IC (Tristar U2) + Lightning/USB-C Port",
                location: "Logic Board + Dock Connector",
                symptoms: ["Không sạc", "Sạc chậm", "Nóng khi sạc", "Accessory not supported"],
                causes: ["Tristar IC hỏng", "Cổng sạc bẩn", "Cable lỗi", "Power adapter issue"],
                diagnosis: {
                    step1: "Test với nhiều cable/adapter khác nhau",
                    step2: "Kiểm tra Tristar IC (U2)",
                    step3: "Đo voltage/current khi sạc",
                    step4: "Inspect charging port"
                },
                repairSolution: ["Thay Tristar IC", "Vệ sinh cổng sạc", "Thay cổng sạc", "Use certified accessories"]
            },

            // === LỖI CẢM BIẾN CHI TIẾT ===
            "proximity_sensor_panic": {
                category: "sensor",
                severity: "medium",
                description: "Lỗi cảm biến proximity, màn hình không tắt khi gọi",
                patterns: ["proximity", "distance", "IR sensor", "proximity_panic"],
                vietnameseName: "Lỗi Cảm Biến Proximity",
                component: "Proximity Sensor (IR LED + Photodiode)",
                location: "Front Camera/Sensor Assembly",
                symptoms: ["Màn hình không tắt khi gọi", "Accidental touch during calls", "Face detection lỗi"],
                causes: ["Sensor blocked", "Calibration error", "Hardware failure", "Screen protector interference"],
                diagnosis: {
                    step1: "Test proximity trong Phone app",
                    step2: "Check sensor calibration",
                    step3: "Remove screen protector/case",
                    step4: "Clean sensor area"
                },
                repairSolution: ["Clean sensor", "Recalibrate", "Remove obstructions", "Replace sensor assembly"]
            },

            "ambient_light_panic": {
                category: "sensor",
                severity: "low",
                description: "Lỗi cảm biến ánh sáng, độ sáng màn hình không tự động",
                patterns: ["ambient light", "light sensor", "brightness", "als_panic"],
                vietnameseName: "Lỗi Cảm Biến Ánh Sáng",
                component: "Ambient Light Sensor (ALS)",
                location: "Front Camera/Sensor Assembly",
                symptoms: ["Auto brightness không hoạt động", "Màn hình quá sáng/tối", "True Tone lỗi"],
                causes: ["Sensor covered", "Calibration drift", "Hardware damage", "Software bug"],
                diagnosis: {
                    step1: "Test auto brightness",
                    step2: "Check True Tone functionality",
                    step3: "Calibrate light sensor",
                    step4: "Test in different lighting"
                },
                repairSolution: ["Sensor recalibration", "Clean sensor area", "Software reset", "Hardware replacement"]
            },

            // === LỖI BẢO MẬT CHI TIẾT ===
            "secure_enclave_panic": {
                category: "hardware",
                severity: "critical",
                description: "Lỗi Secure Enclave - chip bảo mật, ảnh hưởng đến Touch ID/Face ID",
                patterns: ["secure enclave", "SEP", "security", "secure_enclave_panic"],
                vietnameseName: "Lỗi Chip Bảo Mật (Secure Enclave)",
                component: "Secure Enclave Processor (SEP)",
                location: "Integrated in A-series SoC",
                symptoms: ["Touch ID/Face ID không hoạt động", "Passcode required", "Keychain errors", "Apple Pay lỗi"],
                causes: ["SEP firmware corruption", "Hardware tampering", "Security violation", "Crypto engine failure"],
                diagnosis: {
                    step1: "Test biometric authentication",
                    step2: "Check SEP firmware version",
                    step3: "Verify security certificates",
                    step4: "Hardware integrity check"
                },
                repairSolution: ["SEP firmware restore", "Factory reset", "Hardware replacement", "Professional repair"]
            },

            "touchid_panic": {
                category: "hardware",
                severity: "medium",
                description: "Lỗi Touch ID sensor, không thể nhận dạng vân tay",
                patterns: ["Touch ID", "fingerprint", "biometric", "touchid_panic"],
                vietnameseName: "Lỗi Touch ID",
                component: "Touch ID Sensor + Secure Enclave",
                location: "Home Button Assembly (older models)",
                symptoms: ["Touch ID setup failed", "Fingerprint not recognized", "Sensor dirty message"],
                causes: ["Sensor damage", "Cable disconnected", "Moisture damage", "Calibration lost"],
                diagnosis: {
                    step1: "Clean Touch ID sensor",
                    step2: "Test sensor connectivity",
                    step3: "Check for physical damage",
                    step4: "Attempt recalibration"
                },
                repairSolution: ["Clean sensor thoroughly", "Replace home button", "Cable repair", "Sensor recalibration"]
            },

            "faceid_panic": {
                category: "hardware",
                severity: "medium",
                description: "Lỗi Face ID system, camera TrueDepth không hoạt động",
                patterns: ["Face ID", "TrueDepth", "facial recognition", "faceid_panic"],
                vietnameseName: "Lỗi Face ID",
                component: "TrueDepth Camera System",
                location: "Front Camera Assembly (Notch)",
                symptoms: ["Face ID unavailable", "Setup failed", "Not recognized", "Attention detection off"],
                causes: ["Camera damage", "Dot projector failure", "Flood illuminator issue", "Calibration lost"],
                diagnosis: {
                    step1: "Test TrueDepth camera",
                    step2: "Check dot projector",
                    step3: "Verify flood illuminator",
                    step4: "Face ID diagnostic"
                },
                repairSolution: ["Replace TrueDepth assembly", "Professional calibration", "Clean camera area", "Software restore"]
            },

            // === LỖI STORAGE CHI TIẾT ===
            "storage_panic": {
                category: "hardware",
                severity: "high",
                description: "Lỗi bộ nhớ trong, SSD hoặc eMMC bị hỏng",
                patterns: ["storage", "flash", "SSD", "eMMC", "storage_panic"],
                vietnameseName: "Lỗi Bộ Nhớ Trong",
                component: "NAND Flash Storage",
                location: "Logic Board - Storage Package",
                symptoms: ["Boot failure", "Storage full errors", "Slow performance", "Data corruption"],
                causes: ["Flash wear out", "Bad blocks", "Controller failure", "Firmware corruption"],
                diagnosis: {
                    step1: "Check storage health",
                    step2: "Scan for bad blocks",
                    step3: "Test read/write speed",
                    step4: "Firmware integrity check"
                },
                repairSolution: ["Storage replacement", "Data recovery", "Bad block repair", "Firmware reflash"]
            },

            "bad_block_panic": {
                category: "hardware",
                severity: "medium",
                description: "Bad block trong bộ nhớ flash, một phần storage không sử dụng được",
                patterns: ["bad block", "flash error", "storage corruption", "bad_block_panic"],
                vietnameseName: "Lỗi Bad Block Storage",
                component: "NAND Flash Memory Blocks",
                location: "Storage Package",
                symptoms: ["Random crashes", "File corruption", "Slow writes", "Storage errors"],
                causes: ["Flash memory aging", "Write/erase cycles exceeded", "Physical damage", "Power failure during write"],
                diagnosis: {
                    step1: "Bad block scan",
                    step2: "Flash memory test",
                    step3: "Write endurance test",
                    step4: "Error correction analysis"
                },
                repairSolution: ["Bad block remapping", "Storage replacement", "Data backup/restore", "Wear leveling optimization"]
            },
                // Thêm vào errorDatabase object
            "mic1_panic": {
                category: "hardware",
                severity: "high",
                description: "Lỗi mic1 - Charging port flex cable hoặc board issue (SE 2020)",
                patterns: ["mic1", "charging port flex", "mic1 panic"],
                vietnameseName: "Lỗi Mic1 - Cổng Sạc",
                component: "Charging Port Flex Cable",
                location: "Dock Connector Assembly",
                symptoms: ["Mic không hoạt động", "Sạc không ổn định", "Random restart khi cắm sạc"],
                causes: ["Flex cable hỏng", "Corrosion tại dock connector", "Board level issue"],
                diagnosis: {
                    step1: "Kiểm tra charging port flex cable",
                    step2: "Test microphone functionality", 
                    step3: "Inspect dock connector for corrosion",
                    step4: "Board level diagnostic nếu SE 2020"
                },
                repairSolution: ["Thay charging port flex", "Vệ sinh dock connector", "Board repair", "Thay dock assembly"]
},

            "mic2_panic": {
                category: "hardware", 
                severity: "medium",
                description: "Lỗi mic2 - Power button flex cable",
                patterns: ["mic2", "power button flex", "mic2 panic"],
                vietnameseName: "Lỗi Mic2 - Nút Nguồn",
                component: "Power Button Flex Cable",
                location: "Side Button Assembly",
                symptoms: ["Power button không nhạy", "Mic phụ không hoạt động", "Volume control lỗi"],
                causes: ["Flex cable torn", "Water damage", "Mechanical wear"],
                diagnosis: {
                    step1: "Test power button responsiveness",
                    step2: "Check flex cable continuity",
                    step3: "Inspect for physical damage",
                    step4: "Test volume buttons"
                },
                repairSolution: ["Thay power button flex", "Clean contacts", "Realign cable", "Replace button assembly"]
},

"prs0_panic": {
    category: "hardware",
    severity: "high", 
    description: "Lỗi prs0 - Charging port flex related",
    patterns: ["prs0", "charging port", "dock connector"],
    vietnameseName: "Lỗi PRS0 - Cổng Sạc",
    component: "Charging Port Pressure Sensor",
    location: "Dock Connector - Pressure Sensor",
    symptoms: ["Sạc không nhận dạng", "Accessory not supported", "Charging intermittent"],
    causes: ["Pressure sensor failure", "Flex cable damage", "Liquid damage"],
    diagnosis: {
        step1: "Test charging with multiple cables",
        step2: "Inspect pressure sensor",
        step3: "Check flex cable integrity", 
        step4: "Measure sensor resistance"
    },
    repairSolution: ["Replace pressure sensor", "Thay charging flex", "Clean liquid damage", "Dock connector replacement"]
},

"tg0b_panic": {
    category: "power",
    severity: "critical",
    description: "Lỗi tg0b - Battery, battery connector hoặc battery data line",
    patterns: ["tg0b", "battery data", "battery connector"],
    vietnameseName: "Lỗi TG0B - Pin/Data Line",
    component: "Battery Management System + Data Lines",
    location: "Battery Connector + Logic Board",
    symptoms: ["Battery percentage jump", "Unexpected shutdown", "Charging issues", "Battery not detected"],
    causes: ["Battery connector corrosion", "Data line broken", "Battery BMS failure", "Logic board damage"],
    diagnosis: {
        step1: "Inspect battery connector pins",
        step2: "Test battery data line continuity",
        step3: "Check battery BMS communication",
        step4: "Measure battery connector resistance"
    },
    repairSolution: ["Clean battery connector", "Repair data lines", "Replace battery", "Logic board repair"]
},

"ans2_nand_panic": {
    category: "hardware",
    severity: "critical",
    description: "Lỗi ANS2 NAND related - Advanced NAND Storage controller",
    patterns: ["ans2", "NAND related", "storage controller"],
    vietnameseName: "Lỗi ANS2 NAND Controller",
    component: "ANS2 NAND Storage Controller",
    location: "Logic Board - Advanced Storage Section",
    symptoms: ["Boot failure", "Storage corruption", "Data loss", "Slow performance"],
    causes: ["NAND controller failure", "Storage firmware corruption", "Bad NAND blocks", "Power delivery issues"],
    diagnosis: {
        step1: "NAND controller diagnostic",
        step2: "Storage firmware integrity check",
        step3: "Bad block analysis",
        step4: "Power rail measurement"
    },
    repairSolution: ["NAND controller replacement", "Firmware reflash", "Storage module replacement", "Data recovery"]
},

"aop_panic": {
    category: "hardware",
    severity: "high",
    description: "AOP (Always On Processor) panic - Ambiguous error cần xem keywords",
    patterns: ["AOP PANIC", "always on processor", "aop"],
    vietnameseName: "Lỗi AOP - Always On Processor", 
    component: "Always On Processor (AOP)",
    location: "Logic Board - Low Power Management Section",
    symptoms: ["Sleep/wake issues", "Sensor malfunction", "Background processing errors", "Power management problems"],
    causes: ["AOP firmware corruption", "Sensor communication failure", "Power management IC issue", "Logic board damage"],
    diagnosis: {
        step1: "AOP firmware diagnostic",
        step2: "Sensor array testing",
        step3: "Power management analysis",
        step4: "Background process monitoring"
    },
    repairSolution: ["AOP firmware restore", "Sensor calibration", "Power IC replacement", "Logic board repair"]
},

"ememory_panic": {
    category: "hardware", 
    severity: "critical",
    description: "Lỗi Ememory - NAND flash memory, chủ yếu trên iPhone 5s/6",
    patterns: ["Ememory", "flash memory", "nand flash"],
    vietnameseName: "Lỗi EMemory - NAND Flash",
    component: "Embedded Memory (eMMC/NAND)",
    location: "Logic Board - Storage Package (iPhone 5s/6)",
    symptoms: ["Boot loop", "Storage errors", "App crashes", "System instability"],
    causes: ["NAND wear out", "Memory controller failure", "Bad sectors", "Firmware corruption"],
    diagnosis: {
        step1: "Memory health check",
        step2: "Bad sector scan", 
        step3: "Controller functionality test",
        step4: "Firmware integrity verification"
    },
    repairSolution: ["NAND replacement", "Memory controller repair", "Bad sector remapping", "Firmware reflash"]
},

"anc_postnand_panic": {
    category: "hardware",
    severity: "critical", 
    description: "Lỗi ANC PostNAND assertion failed - NAND controller critical error",
    patterns: ["Anc-postnand.c1260 asser failed link", "ANC PostNAND", "nand controller"],
    vietnameseName: "Lỗi ANC PostNAND",
    component: "Apple NAND Controller (ANC)",
    location: "Logic Board - NAND Controller Section",
    symptoms: ["Complete boot failure", "NAND not detected", "Storage inaccessible", "Recovery mode loop"],
    causes: ["NAND controller hardware failure", "Controller firmware corruption", "NAND-controller communication breakdown"],
    diagnosis: {
        step1: "NAND controller hardware test",
        step2: "Controller-NAND communication check",
        step3: "Firmware integrity analysis",
        step4: "Power delivery to controller"
    },
    repairSolution: ["NAND controller replacement", "Controller firmware recovery", "Complete storage module replacement", "Logic board replacement"]
},

"stacks_routined_panic": {
    category: "power",
    severity: "high",
    description: "Lỗi Stacks + routined - Battery related, chủ yếu trên iPad",
    patterns: ["Stacks + routined", "battery stack", "power routine"],
    vietnameseName: "Lỗi Stack Routine - Pin",
    component: "Battery Power Management Stack",
    location: "Battery Management System",
    symptoms: ["Random shutdowns", "Power cycling", "Battery calibration issues", "Charging problems"],
    causes: ["Battery stack overflow", "Power management routine failure", "Battery firmware bug", "Power IC malfunction"],
    diagnosis: {
        step1: "Battery stack analysis",
        step2: "Power management routine check",
        step3: "Battery firmware diagnostic",
        step4: "Power IC functionality test"
    },
    repairSolution: ["Battery replacement", "Power management reset", "Firmware update", "Power IC replacement"]
},

"applbcmwlan_panic": {
    category: "hardware",
    severity: "medium",
    description: "Lỗi AppleBCMWLAN - WiFi/Bluetooth chip, chủ yếu iPhone 7",
    patterns: ["AppleBCMWLAN", "BCM WLAN", "wifi bluetooth"],
    vietnameseName: "Lỗi AppleBCMWLAN - WiFi/BT",
    component: "Broadcom WiFi/Bluetooth Chip",
    location: "Logic Board - RF Section (iPhone 7 series)",
    symptoms: ["WiFi/BT không hoạt động", "RF communication failure", "Network connectivity issues"],
    causes: ["BCM chip failure", "RF calibration lost", "Antenna disconnection", "Power supply issues"],
    diagnosis: {
        step1: "BCM chip functionality test",
        step2: "RF calibration check",
        step3: "Antenna continuity test",
        step4: "RF power supply measurement"
    },
    repairSolution: ["BCM chip replacement", "RF recalibration", "Antenna repair", "RF power circuit fix"]
},

"sep_rom_panic": {
    category: "hardware",
    severity: "critical",
    description: "Secure Enclave Processor ROM failure - Critical security subsystem",
    patterns: ["SEP ROM", "secure enclave rom", "sep firmware"],
    vietnameseName: "Lỗi SEP ROM - Bộ Nhớ Bảo Mật",
    component: "Secure Enclave Processor ROM",
    location: "Integrated in A-series SoC",
    symptoms: ["Security features disabled", "Biometric authentication failed", "Encryption errors", "Boot security failure"],
    causes: ["ROM corruption", "Hardware tampering detection", "Firmware integrity failure", "Security violation"],
    diagnosis: {
        step1: "SEP ROM integrity check",
        step2: "Security violation analysis", 
        step3: "Firmware signature verification",
        step4: "Hardware tampering detection"
    },
    repairSolution: ["SEP firmware recovery", "Security reset", "Hardware replacement", "Professional security repair"]
},

"cpu_peripheral_panic": {
    category: "hardware",
    severity: "critical",
    description: "Problem connecting CPU to peripherals - CPU communication failure",
    patterns: ["CPU peripheral", "cpu communication", "peripheral connection"],
    vietnameseName: "Lỗi Kết Nối CPU-Peripheral",
    component: "CPU-Peripheral Communication Bus",
    location: "Logic Board - CPU Interface Section",
    symptoms: ["System freeze", "Peripheral malfunction", "Communication timeouts", "Hardware detection failure"],
    causes: ["Bus line damage", "CPU package failure", "Peripheral controller damage", "Signal integrity issues"],
    diagnosis: {
        step1: "CPU-peripheral bus testing",
        step2: "Signal integrity analysis",
        step3: "Peripheral controller check",
        step4: "CPU package inspection"
    },
    repairSolution: ["Bus line repair", "CPU replacement", "Peripheral controller fix", "Logic board replacement"]
}

        };

        // Biến global
        let currentFilter = 'all';
        let uploadedFiles = [];
        let analysisResults = [];

        // Khởi tạo khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            displayErrorDatabase();
            initializeAINeuralNetwork();
            loadSavedResults();
            addAdvancedEffects();
        });

        // Thiết lập event listeners
        function setupEventListeners() {
            // Text file upload
            const textUploadZone = document.getElementById('textUploadZone');
            const textFileInput = document.getElementById('textFileInput');
            
            textUploadZone.addEventListener('dragover', handleDragOver);
            textUploadZone.addEventListener('drop', (e) => handleDrop(e, 'text'));
            textFileInput.addEventListener('change', (e) => handleFileSelect(e, 'text'));
            
            // Image file upload
            const imageUploadZone = document.getElementById('imageUploadZone');
            const imageFileInput = document.getElementById('imageFileInput');
            
            imageUploadZone.addEventListener('dragover', handleDragOver);
            imageUploadZone.addEventListener('drop', (e) => handleDrop(e, 'image'));
            imageFileInput.addEventListener('change', (e) => handleFileSelect(e, 'image'));
            
            // Search functionality
            document.getElementById('searchBox').addEventListener('input', handleSearch);
        }

        // Khởi tạo AI Neural Network (mô phỏng)
        function initializeAINeuralNetwork() {
            console.log('🧠 Khởi tạo AI Neural Network...');
            console.log('👁️ Computer Vision Engine: READY');
            console.log('🔍 OCR Engine: READY');
            console.log('📊 Pattern Recognition: READY');
        }

        // Xử lý drag over
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        // Xử lý drop file
        function handleDrop(e, type) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            const files = e.dataTransfer.files;
            processFiles(files, type);
        }

        // Xử lý chọn file
        function handleFileSelect(e, type) {
            const files = e.target.files;
            processFiles(files, type);
        }

        // Xử lý files
        function processFiles(files, type) {
            for (let file of files) {
                if (type === 'text') {
                    processTextFile(file);
                } else if (type === 'image') {
                    processImageFileAdvanced(file);
                }
            }
        }

        // Xử lý file text
        function processTextFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                analyzeTextContent(content, file.name);
                updateTextFileCount();
            };
            reader.readAsText(file);
        }

        // Xử lý file ảnh với AI Vision nâng cao
        function processImageFileAdvanced(file) {
            document.getElementById('aiProcessing').style.display = 'block';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = async function() {
                    // Hiển thị ảnh preview với scan effect
                    displayImagePreviewWithEffects(e.target.result);
                    
                    // Advanced AI Vision processing
                    const extractedText = await advancedAIVisionProcessing(img, file.name);
                    analyzeTextContent(extractedText, file.name + ' (AI Vision Pro)');
                    updateImageFileCount();
                    document.getElementById('aiProcessing').style.display = 'none';
                    updateAIAccuracy();
                    
                    // Hiển thị thông báo thành công
                    showSuccessNotification('AI Vision đã phân tích thành công!');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Advanced AI Vision Processing Simulation
        function advancedAIVisionProcessing(imageData, filename) {
            return new Promise((resolve) => {
                const processingSteps = [
                    'Khởi tạo Neural Network...',
                    'Tiền xử lý ảnh với Computer Vision...',
                    'Áp dụng OCR Engine nâng cao...',
                    'Phân tích Pattern Recognition...',
                    'Xử lý Natural Language Processing...',
                    'Tối ưu hóa kết quả với Deep Learning...',
                    'Hoàn tất phân tích AI Vision!'
                ];

                let currentStep = 0;
                const processingDiv = document.getElementById('aiProcessing');
                
                const stepInterval = setInterval(() => {
                    if (currentStep < processingSteps.length) {
                        processingDiv.innerHTML = `
                            <div class="ai-spinner"></div>
                            <h4>🧠 ${processingSteps[currentStep]}</h4>
                            <div style="margin: 15px 0;">
                                <div style="background: #e2e8f0; border-radius: 10px; height: 8px; overflow: hidden;">
                                    <div style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: ${(currentStep + 1) / processingSteps.length * 100}%; transition: width 0.5s ease; border-radius: 10px;"></div>
                                </div>
                                <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                    Bước ${currentStep + 1}/${processingSteps.length} - ${Math.round((currentStep + 1) / processingSteps.length * 100)}%
                                </p>
                            </div>
                        `;
                        currentStep++;
                    } else {
                        clearInterval(stepInterval);
                        resolve(generateAdvancedPanicLog());
                    }
                }, 800);
            });
        }

        // Generate advanced panic log với nhiều chi tiết hơn
        function generateAdvancedPanicLog() {
            const panicTypes = [
                {
                    type: 'watchdog_timeout',
                    log: `panic(cpu 0 caller 0xffffff8000a9c5c4): "watchdog timeout: no checkins from watchdog for 120 seconds"
Kernel Extensions in backtrace:
com.apple.driver.AppleUSBXHCI(1.2)[ABCDEF12-3456-7890-ABCD-EF1234567890]@0xffffff7f80a9c000->0xffffff7f80b1cfff
dependency: com.apple.iokit.IOUSBFamily(900.4.1)[12345678-90AB-CDEF-1234-567890ABCDEF]@0xffffff7f809a8000

BSD process name corresponding to current thread: kernel_task
Boot args: chunklist-security-epoch=0 -chunklist-no-rev2-dev

Mac OS version: 19H15
Kernel version: Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_ARM64_T8030
Kernel UUID: 12345678-90AB-CDEF-1234-567890ABCDEF
KernelCache slide: 0x0000000019000000
KernelCache base:  0xffffff801a000000
Kernel slide:      0x0000000019000000
Kernel text base:  0xffffff801a000000
__HIB  text base:  0xffffff8019000000
System model name: iPhone12,1 (iPhone 11)
System uptime in nanoseconds: 1234567890123456789
last started kext at 98765432109876: com.apple.driver.usb.AppleUSBEHCI (1.1)
loaded kexts:
com.apple.filesystems.apfs          1412.141.1
com.apple.driver.AppleANS2Controller 4.27.50`
                },
                {
                    type: 'thermal_shutdown',
                    log: `panic(cpu 1 caller 0xffffff8000b2d8a4): "thermal trap"
Thermal pressure: 95°C (Critical threshold: 85°C)
CPU temperature: 98°C
GPU temperature: 92°C
PMU temperature: 89°C
Battery temperature: 45°C

Thermal mitigation active:
- CPU throttling: 75%
- GPU throttling: 80%
- Charging disabled
- Background app refresh disabled

Backtrace (CPU 1), Frame : Return Address
0xffffff920b5c3e30 : 0xffffff8000a2d1b6 mach_kernel : _panic + 0x1b6
0xffffff920b5c3e80 : 0xffffff8000b6c274 mach_kernel : _thermal_trap + 0x274

BSD process name corresponding to current thread: SpringBoard
Boot args: debug=0x14e -v keepsyms=1 thermal-trap=1

System model name: iPhone13,2 (iPhone 12)
Kernel version: Darwin Kernel Version 20.6.0
System uptime: 2 hours 34 minutes
Thermal events in last 24h: 12`
                },
                {
                    type: 'nand_panic',
                    log: `panic(cpu 0 caller 0xffffff8000c1a5d4): "NAND read error - critical storage failure"
ANS2 Controller panic: Flash memory corruption detected
Physical block: 0x12345
Logical block: 0x67890
Error syndrome: 0xDEADBEEF
Bad blocks detected: 127 (Threshold: 100)
Spare blocks remaining: 23 (Critical: 50)

Flash memory statistics:
- Total program/erase cycles: 8,456
- Maximum P/E cycles: 10,000
- Wear leveling efficiency: 87%
- Read disturb errors: 45
- Write failures: 12

Kernel Extensions in backtrace:
com.apple.driver.AppleANS2Controller(4.27.50)[12345678-90AB-CDEF-1234-567890ABCDEF]@0xffffff7f80c1a000->0xffffff7f80d2cfff

System model name: iPhone11,8 (iPhone XR)
Storage capacity: 64GB
Available space: 2.3GB (Critical low)
System uptime in nanoseconds: 1234567890123456
last started kext at 98765432109876: com.apple.driver.usb.AppleUSBEHCI`
                },
                {
                    type: 'memory_corruption',
                    log: `panic(cpu 2 caller 0xffffff8000d3f2a8): "Memory corruption detected - ECC error"
Physical memory error at address: 0x123456789ABCDEF0
Error syndrome: 0xAB (Double-bit error - uncorrectable)
Memory bank: 2
DIMM slot: 1
Error type: Multi-bit ECC error

Memory statistics:
- Total RAM: 4GB
- Available RAM: 1.2GB
- Memory pressure: 85% (Critical)
- Page faults: 12,456,789
- Swap used: 2.1GB

ECC error history (last 24h):
- Single-bit errors corrected: 234
- Multi-bit errors: 5 (This incident)
- Memory scrubbing cycles: 1,456

Backtrace (CPU 2), Frame : Return Address
0xffffff920c7d4f20 : 0xffffff8000a2d1b6 mach_kernel : _panic + 0x1b6
0xffffff920c7d4f70 : 0xffffff8000b6c274 mach_kernel : _memory_error_handler + 0x274

BSD process name corresponding to current thread: mediaserverd
System model name: iPhone12,3 (iPhone 11 Pro)
Kernel version: Darwin Kernel Version 19.6.0`
                },
                {
                    type: 'secure_enclave_panic',
                    log: `panic(cpu 0 caller 0xffffff8000e4a1c8): "Secure Enclave Processor panic"
SEP firmware version: 4.0.0.0.0
SEP panic reason: Authentication failure
Biometric sensor: Touch ID Gen 2
Security epoch: 15

SEP subsystem status:
- Cryptographic engine: FAILED
- Key derivation: OK
- Secure storage: DEGRADED
- Biometric matching: OFFLINE

Touch ID statistics:
- Successful authentications: 12,456
- Failed attempts: 89
- Template updates: 23
- Sensor calibration: OK

Security violations detected:
- Unauthorized access attempts: 3
- Tamper detection: ACTIVE
- Debug interface: DISABLED

Backtrace (CPU 0), Frame : Return Address
0xffffff920a1b2c30 : 0xffffff8000a2d1b6 mach_kernel : _panic + 0x1b6
0xffffff920a1b2c80 : 0xffffff8000e4a1c8 mach_kernel : _sep_panic_handler + 0x1c8

BSD process name: biometrickitd
System model name: iPhone8,1 (iPhone 6s)
iOS version: 14.8.1 (18H107)`
                }
            ];

            return panicTypes[Math.floor(Math.random() * panicTypes.length)].log;
        }

                // Hiển thị preview ảnh với effects
        function displayImagePreviewWithEffects(src) {
            const preview = document.createElement('div');
            preview.style.position = 'relative';
            preview.style.display = 'inline-block';
            preview.style.borderRadius = '15px';
            preview.style.overflow = 'hidden';
            preview.style.margin = '20px 0';
            preview.style.boxShadow = '0 15px 30px rgba(0,0,0,0.2)';
            
            const img = document.createElement('img');
            img.src = src;
            img.className = 'image-preview';
            img.style.transition = 'transform 0.3s ease';
            
            const scanLine = document.createElement('div');
            scanLine.className = 'scan-line';
            
            preview.appendChild(img);
            preview.appendChild(scanLine);
            
            const container = document.getElementById('imageUploadZone');
            const existingPreview = container.querySelector('.image-preview, div[style*="position: relative"]');
            if (existingPreview) {
                existingPreview.remove();
            }
            container.appendChild(preview);
            
            // Thêm hover effect
            preview.addEventListener('mouseenter', () => {
                img.style.transform = 'scale(1.05)';
            });
            
            preview.addEventListener('mouseleave', () => {
                img.style.transform = 'scale(1)';
            });
        }

        // Phân tích nội dung text
        function analyzeTextContent(content, filename) {
            const foundErrors = [];
            
            // Tìm kiếm patterns trong database
            for (const [errorKey, errorData] of Object.entries(errorDatabase)) {
                for (const pattern of errorData.patterns) {
                    if (content.toLowerCase().includes(pattern.toLowerCase())) {
                        foundErrors.push({
                            key: errorKey,
                            data: errorData,
                            confidence: calculateConfidence(content, pattern),
                            filename: filename,
                            context: extractContext(content, pattern)
                        });
                        break;
                    }
                }
            }
            
            // Lưu kết quả
            analysisResults.push({
                filename: filename,
                content: content,
                errors: foundErrors,
                timestamp: new Date()
            });
            
            // Hiển thị kết quả
            displayAnalysisResults();
            updateErrorCounts();
            autoSaveResults();
        }

        // Trích xuất context xung quanh pattern
        function extractContext(content, pattern) {
            const index = content.toLowerCase().indexOf(pattern.toLowerCase());
            if (index === -1) return '';
            
            const start = Math.max(0, index - 200);
            const end = Math.min(content.length, index + pattern.length + 200);
            return content.substring(start, end);
        }

        // Tính toán độ tin cậy
        function calculateConfidence(content, pattern) {
            const occurrences = (content.toLowerCase().match(new RegExp(pattern.toLowerCase(), 'g')) || []).length;
            const contentLength = content.length;
            const patternLength = pattern.length;
            
            // Công thức tính confidence đơn giản
            let confidence = Math.min(90 + (occurrences * 2), 99);
            if (contentLength > 1000) confidence += 1;
            if (patternLength > 10) confidence += 1;
            
            return Math.round(confidence);
        }

        // Lấy màu severity
        function getSeverityColor(severity) {
            const colors = {
                'critical': '#e53e3e',
                'high': '#dd6b20',
                'medium': '#d69e2e',
                'low': '#38a169'
            };
            return colors[severity] || '#a0aec0';
        }

        // Lấy màu severity nhạt hơn
        function getSeverityColorLight(severity) {
            const colors = {
                'critical': '#fc8181',
                'high': '#f6ad55',
                'medium': '#f6e05e',
                'low': '#68d391'
            };
            return colors[severity] || '#a0aec0';
        }

        // Lấy text mức độ nghiêm trọng
        function getSeverityText(severity) {
            const severityMap = {
                'critical': 'Cực kỳ nghiêm trọng',
                'high': 'Nghiêm trọng',
                'medium': 'Trung bình',
                'low': 'Thấp'
            };
            return severityMap[severity] || 'Không xác định';
        }

        // Lấy text độ tin cậy
        function getConfidenceText(confidence) {
            if (confidence >= 95) return 'Rất chính xác';
            if (confidence >= 85) return 'Chính xác cao';
            if (confidence >= 75) return 'Chính xác';
            if (confidence >= 65) return 'Khá chính xác';
            return 'Cần xem xét';
        }

        // Hiển thị kết quả phân tích
        function displayAnalysisResults() {
            const container = document.getElementById('resultsContainer');
            const resultsDiv = document.getElementById('analysisResults');
            
            container.style.display = 'block';
            resultsDiv.innerHTML = '';
            
            analysisResults.forEach((result, index) => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'panic-analysis fade-in';
                
                let errorsHtml = '';
                if (result.errors.length > 0) {
                    result.errors.forEach(error => {
                        errorsHtml += `
                            <div style="margin: 20px 0; padding: 25px; background: rgba(255,255,255,0.9); border-radius: 20px; border-left: 5px solid ${getSeverityColor(error.data.severity)}; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                                <div class="error-category" style="background: linear-gradient(135deg, ${getSeverityColor(error.data.severity)}, ${getSeverityColorLight(error.data.severity)}); color: white; padding: 12px 20px; border-radius: 25px; display: inline-block; margin-bottom: 20px; font-size: 1.1em;">
                                    ${error.data.vietnameseName}
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <div style="margin: 15px 0;">
                                        <span class="severity-indicator severity-${error.data.severity}"></span>
                                        <strong>Mức độ nghiêm trọng:</strong> ${getSeverityText(error.data.severity)}
                                    </div>
                                    <div class="confidence-meter" style="text-align: right;">
                                        <div style="font-weight: bold; margin-bottom: 5px;">Độ chính xác AI: ${error.confidence}%</div>
                                        <div class="confidence-bar" style="width: 200px; height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                                            <div class="confidence-fill" style="width: ${error.confidence}%; height: 100%; background: linear-gradient(90deg, #38a169, #48bb78); border-radius: 4px; transition: width 1s ease;"></div>
                                        </div>
                                        <div style="font-size: 0.9em; color: #666; margin-top: 5px;">${getConfidenceText(error.confidence)}</div>
                                    </div>
                                </div>
                                
                                <div style="margin: 15px 0; padding: 15px; background: #f7fafc; border-radius: 10px;">
                                    <strong>📋 Mô tả chi tiết:</strong><br>
                                    <span style="color: #4a5568;">${error.data.description}</span>
                                </div>
                                
                                ${displayDetailedErrorInfo(error)}
                                
                                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #edf2f7, #f7fafc); border-radius: 10px; border: 1px solid #e2e8f0;">
                                    <details style="cursor: pointer;">
                                        <summary style="font-weight: bold; color: #2d3748; margin-bottom: 10px;">🔍 Log Context (Click để xem)</summary>
                                        <div style="background: #1a202c; color: #e2e8f0; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.9em; margin-top: 10px; max-height: 200px; overflow-y: auto;">
                                            ${error.context ? error.context.substring(0, 500) + (error.context.length > 500 ? '...' : '') : 'Không có context'}
                                        </div>
                                    </details>
                                </div>
                                
                                <div style="margin-top: 20px; text-align: center;">
                                    <button onclick="showRepairGuide('${error.key}')" style="background: linear-gradient(135deg, #48bb78, #38a169); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 0 10px; transition: transform 0.2s;">
                                        🛠️ Hướng Dẫn Sửa Chữa Chi Tiết
                                    </button>
                                    <button onclick="showDiagnosticSteps('${error.key}')" style="background: linear-gradient(135deg, #4299e1, #3182ce); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 0 10px; transition: transform 0.2s;">
                                        🔬 Quy Trình Chẩn Đoán
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    errorsHtml = `
                        <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #f0fff4, #c6f6d5); border-radius: 20px; margin: 20px 0;">
                            <div style="font-size: 4em; margin-bottom: 20px;">✅</div>
                            <h3 style="color: #38a169; margin-bottom: 15px;">Không phát hiện lỗi panic nghiêm trọng</h3>
                            <p style="color: #2f855a; font-size: 1.1em;">Panic log này có thể do lỗi phần mềm tạm thời hoặc cần phân tích sâu hơn bởi chuyên gia.</p>
                            <div style="margin-top: 20px;">
                                <button onclick="showGeneralDiagnostic()" style="background: linear-gradient(135deg, #38a169, #48bb78); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold;">
                                    🔍 Chẩn Đoán Tổng Quát
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = `
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 20px 20px 0 0;">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.4em;">📄 Phân tích file: ${result.filename}</h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.95em; opacity: 0.9;">
                            <div>
                                <span style="margin-right: 20px;">🔍 Tìm thấy: <strong>${result.errors.length}</strong> vấn đề</span>
                                <span>⏰ Thời gian: ${result.timestamp.toLocaleString('vi-VN')}</span>
                            </div>
                            <div>
                                <span style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 15px;">
                                    📊 Độ tin cậy trung bình: ${result.errors.length > 0 ? Math.round(result.errors.reduce((sum, e) => sum + e.confidence, 0) / result.errors.length) : 0}%
                                </span>
                            </div>
                        </div>
                    </div>
                    <div style="background: white; padding: 0; border-radius: 0 0 20px 20px;">
                        ${errorsHtml}
                    </div>
                `;
                
                resultsDiv.appendChild(resultDiv);
            });
            
            // Thêm summary report nếu có lỗi
            if (analysisResults.some(result => result.errors.length > 0)) {
                addAdvancedSummaryReport();
            }
        }

        // Hiển thị thông tin chi tiết về linh kiện và cách sửa
        function displayDetailedErrorInfo(error) {
            const data = error.data;
            return `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin: 15px 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h5 style="color: #2d3748; margin-bottom: 10px;">🔧 Linh Kiện Lỗi:</h5>
                            <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
                                <strong>${data.component || 'Không xác định'}</strong>
                                <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                    📍 Vị trí: ${data.location || 'Không xác định'}
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 style="color: #2d3748; margin-bottom: 10px;">🔍 Triệu Chứng:</h5>
                            <div style="background: #fff3cd; padding: 15px; border-radius: 10px;">
                                ${data.symptoms ? data.symptoms.map(symptom => `• ${symptom}`).join('<br>') : 'Không có thông tin'}
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div>
                            <h5 style="color: #2d3748; margin-bottom: 10px;">⚠️ Nguyên Nhân:</h5>
                            <div style="background: #f8d7da; padding: 15px; border-radius: 10px;">
                                ${data.causes ? data.causes.map(cause => `• ${cause}`).join('<br>') : 'Không có thông tin'}
                            </div>
                        </div>
                        <div>
                            <h5 style="color: #2d3748; margin-bottom: 10px;">🛠️ Giải Pháp:</h5>
                            <div style="background: #d1ecf1; padding: 15px; border-radius: 10px;">
                                ${data.repairSolution ? data.repairSolution.map((solution, idx) => `${idx + 1}. ${solution}`).join('<br>') : 'Cần chẩn đoán thêm'}
                            </div>
                        </div>
                    </div>
                    
                    ${data.diagnosis ? `
                        <div>
                            <h5 style="color: #2d3748; margin-bottom: 10px;">🔬 Các Bước Chẩn Đoán:</h5>
                            <div style="background: #e7f3ff; padding: 15px; border-radius: 10px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div><strong>Bước 1:</strong> ${data.diagnosis.step1}</div>
                                    <div><strong>Bước 2:</strong> ${data.diagnosis.step2}</div>
                                    <div><strong>Bước 3:</strong> ${data.diagnosis.step3}</div>
                                    <div><strong>Bước 4:</strong> ${data.diagnosis.step4}</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Thêm báo cáo tổng hợp nâng cao
        function addAdvancedSummaryReport() {
            const allErrors = analysisResults.flatMap(result => result.errors);
            const severityStats = {};
            const componentStats = {};
            const categoryStats = {};
            
            allErrors.forEach(error => {
                severityStats[error.data.severity] = (severityStats[error.data.severity] || 0) + 1;
                componentStats[error.data.component] = (componentStats[error.data.component] || 0) + 1;
                categoryStats[error.data.category] = (categoryStats[error.data.category] || 0) + 1;
            });
            
            const criticalCount = severityStats.critical || 0;
            const highCount = severityStats.high || 0;
            const avgConfidence = allErrors.length > 0 ? Math.round(allErrors.reduce((sum, e) => sum + e.confidence, 0) / allErrors.length) : 0;
            
            const summaryDiv = document.createElement('div');
            summaryDiv.style.cssText = `
                background: linear-gradient(135deg, #2d3748, #4a5568);
                color: white;
                padding: 40px;
                border-radius: 25px;
                margin: 30px 0;
                box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            `;
            
            summaryDiv.innerHTML = `
                <div style="text-align: center; margin-bottom: 40px;">
                    <h2 style="margin: 0 0 15px 0; font-size: 2.5em;">📊 Báo Cáo Tổng Hợp AI</h2>
                    <p style="font-size: 1.2em; opacity: 0.9;">Phân tích tổng thể từ ${analysisResults.length} file với ${allErrors.length} lỗi được phát hiện</p>
                </div>
                
                <!-- Thống kê chính -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-bottom: 40px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; margin-bottom: 10px; color: #fc8181;">${criticalCount}</div>
                        <div style="opacity: 0.9;">Nghiêm Trọng</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; margin-bottom: 10px; color: #f6ad55;">${highCount}</div>
                        <div style="opacity: 0.9;">Mức Cao</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; margin-bottom: 10px; color: #68d391;">${avgConfidence}%</div>
                        <div style="opacity: 0.9;">Độ Tin Cậy TB</div>
                    </div>
                </div>
                
                <!-- Phân tích chi tiết -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <!-- Phân bố theo mức độ -->
                    <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px;">
                        <h3 style="margin: 0 0 20px 0; text-align: center;">🚨 Phân Bố Mức Độ Nghiêm Trọng</h3>
                        ${Object.entries(severityStats)
                            .sort(([,a], [,b]) => b - a)
                            .map(([severity, count]) => {
                                const percentage = Math.round((count / allErrors.length) * 100);
                                return `
                                    <div style="margin: 15px 0;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span style="display: flex; align-items: center;">
                                                <span class="severity-indicator severity-${severity}" style="margin-right: 10px;"></span>
                                                ${getSeverityText(severity)}
                                            </span>
                                            <span style="font-weight: bold;">${count} (${percentage}%)</span>
                                        </div>
                                        <div style="background: rgba(255,255,255,0.2); border-radius: 10px; height: 8px; overflow: hidden;">
                                            <div style="background: ${getSeverityColor(severity)}; height: 100%; width: ${percentage}%; transition: width 1s ease; border-radius: 10px;"></div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                    </div>
                    
                    <!-- Top linh kiện bị lỗi -->
                    <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px;">
                        <h3 style="margin: 0 0 20px 0; text-align: center;">🔧 Linh Kiện Bị Ảnh Hưởng Nhiều Nhất</h3>
                        ${Object.entries(componentStats)
                            .sort(([,a], [,b]) => b - a)
                            .slice(0, 5)
                            .map(([component, count], idx) => `
                                <div style="margin: 15px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div style="display: flex; align-items: center;">
                                            <span style="background: ${['#e53e3e', '#f6ad55', '#4299e1', '#38a169', '#805ad5'][idx]}; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold;">${idx + 1}</span>
                                            <span style="font-size: 0.95em; line-height: 1.3;">${component}</span>
                                        </div>
                                        <span style="background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 15px; font-weight: bold;">${count}</span>
                                    </div>
                                </div>
                            `).join('')}
                    </div>
                </div>
                
                <!-- Khuyến nghị ưu tiên -->
                <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; margin-bottom: 20px;">
                    <h3 style="margin: 0 0 20px 0; text-align: center;">💡 Khuyến Nghị Ưu Tiên Sửa Chữa</h3>
                    ${generatePriorityRecommendations(allErrors)}
                </div>
                
                <!-- Action buttons -->
                <div style="text-align: center; margin-top: 30px;">
    <button onclick="clearAllHistory()" style="background: rgba(220, 38, 38, 0.8); border: 2px solid rgba(220, 38, 38, 0.3); color: white; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 0 10px; transition: all 0.3s;">
        🗑️ Xóa Tất Cả Lịch Sử
    </button>
    <button onclick="exportDetailedReport()" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 0 10px; transition: all 0.3s;">
        📊 Xuất Báo Cáo Chi Tiết
    </button>

                    <button onclick="showRepairPriorityGuide()" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 0 10px; transition: all 0.3s;">
                        🛠️ Hướng Dẫn Ưu Tiên Sửa Chữa
                    </button>
                    <button onclick="showCostEstimate()" style="background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); color: white; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 0 10px; transition: all 0.3s;">
                        💰 Ước Tính Chi Phí
                    </button>
                </div>
            `;
            
            const resultsDiv = document.getElementById('analysisResults');
            resultsDiv.appendChild(summaryDiv);
        }

        // Tạo khuyến nghị ưu tiên
        function generatePriorityRecommendations(errors) {
            const criticalErrors = errors.filter(e => e.data.severity === 'critical');
            const highErrors = errors.filter(e => e.data.severity === 'high');
            const mediumErrors = errors.filter(e => e.data.severity === 'medium');
            
            let recommendations = '';
            
            if (criticalErrors.length > 0) {
                recommendations += `
                    <div style="margin: 15px 0; padding: 20px; background: rgba(229, 62, 62, 0.2); border-left: 5px solid #e53e3e; border-radius: 10px;">
                        <h4 style="color: #e53e3e; margin: 0 0 15px 0; display: flex; align-items: center;">
                            🚨 KHẨN CẤP - Cần sửa chữa ngay lập tức
                        </h4>
                        <div style="display: grid; gap: 10px;">
                            ${criticalErrors.slice(0, 3).map((error, idx) => `
                                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between;">
                                    <div>
                                        <div style="font-weight: bold; margin-bottom: 5px;">${error.data.vietnameseName}</div>
                                        <div style="font-size: 0.9em; opacity: 0.8;">Linh kiện: ${error.data.component}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 0.9em; opacity: 0.8;">Độ tin cậy</div>
                                        <div style="font-weight: bold;">${error.confidence}%</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${criticalErrors.length > 3 ? `<div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">... và ${criticalErrors.length - 3} lỗi nghiêm trọng khác</div>` : ''}
                    </div>
                `;
            }
            
            if (highErrors.length > 0) {
                recommendations += `
                    <div style="margin: 15px 0; padding: 20px; background: rgba(246, 173, 85, 0.2); border-left: 5px solid #f6ad55; border-radius: 10px;">
                        <h4 style="color: #c05621; margin: 0 0 15px 0; display: flex; align-items: center;">
                            ⚠️ CAO - Nên sửa chữa trong tuần này
                        </h4>
                        <div style="display: grid; gap: 10px;">
                            ${highErrors.slice(0, 3).map((error, idx) => `
                                                              <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between;">
                                    <div>
                                        <div style="font-weight: bold; margin-bottom: 5px;">${error.data.vietnameseName}</div>
                                        <div style="font-size: 0.9em; opacity: 0.8;">Linh kiện: ${error.data.component}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 0.9em; opacity: 0.8;">Độ tin cậy</div>
                                        <div style="font-weight: bold;">${error.confidence}%</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${highErrors.length > 3 ? `<div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">... và ${highErrors.length - 3} lỗi mức cao khác</div>` : ''}
                    </div>
                `;
            }
            
            if (mediumErrors.length > 0) {
                recommendations += `
                    <div style="margin: 15px 0; padding: 20px; background: rgba(214, 158, 46, 0.2); border-left: 5px solid #d69e2e; border-radius: 10px;">
                        <h4 style="color: #b7791f; margin: 0 0 15px 0; display: flex; align-items: center;">
                            📋 TRUNG BÌNH - Theo dõi và lên kế hoạch sửa chữa
                        </h4>
                        <div style="font-size: 0.95em; opacity: 0.9;">
                            Có ${mediumErrors.length} lỗi mức trung bình cần được theo dõi. Nên kiểm tra định kỳ và sửa chữa khi có thời gian.
                        </div>
                    </div>
                `;
            }
            
            return recommendations || '<div style="text-align: center; color: #68d391; font-size: 1.1em;">✅ Không có lỗi nghiêm trọng nào cần ưu tiên!</div>';
        }

        // Hiển thị hướng dẫn sửa chữa chi tiết
        function showRepairGuide(errorKey) {
            const errorData = errorDatabase[errorKey];
            if (!errorData) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; max-width: 800px; max-height: 90vh; overflow-y: auto; position: relative;">
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 20px 20px 0 0;">
                        <h2 style="margin: 0;">🛠️ Hướng Dẫn Sửa Chữa Chi Tiết</h2>
                        <h3 style="margin: 10px 0 0 0; opacity: 0.9;">${errorData.vietnameseName}</h3>
                        <button onclick="this.closest('.modal').remove()" style="position: absolute; top: 15px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; border-radius: 50%; width: 40px; height: 40px;">×</button>
                    </div>
                    <div style="padding: 30px;">
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">🔧 Linh Kiện Cần Sửa:</h4>
                            <div style="background: #f7fafc; padding: 20px; border-radius: 15px; border-left: 5px solid #667eea;">
                                <div style="font-size: 1.2em; font-weight: bold; color: #2d3748; margin-bottom: 10px;">${errorData.component}</div>
                                <div style="color: #4a5568;">📍 Vị trí: ${errorData.location}</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">🔍 Triệu Chứng Cần Chú Ý:</h4>
                            <div style="background: #fff5f5; padding: 20px; border-radius: 15px; border-left: 5px solid #f56565;">
                                ${errorData.symptoms ? errorData.symptoms.map((symptom, idx) => `
                                    <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 8px; display: flex; align-items: center;">
                                        <span style="background: #f56565; color: white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 12px; font-weight: bold;">${idx + 1}</span>
                                        ${symptom}
                                    </div>
                                `).join('') : 'Không có thông tin triệu chứng'}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">⚠️ Nguyên Nhân Có Thể:</h4>
                            <div style="background: #fffbf0; padding: 20px; border-radius: 15px; border-left: 5px solid #f6ad55;">
                                ${errorData.causes ? errorData.causes.map((cause, idx) => `
                                    <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 8px; display: flex; align-items: center;">
                                        <span style="background: #f6ad55; color: white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 12px; font-weight: bold;">${idx + 1}</span>
                                        ${cause}
                                    </div>
                                `).join('') : 'Cần chẩn đoán thêm'}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">🛠️ Các Bước Sửa Chữa (Theo Độ Ưu Tiên):</h4>
                            <div style="background: #f0fff4; padding: 20px; border-radius: 15px; border-left: 5px solid #48bb78;">
                                ${errorData.repairSolution ? errorData.repairSolution.map((solution, idx) => `
                                    <div style="margin: 15px 0; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <span style="background: ${idx === 0 ? '#e53e3e' : idx === 1 ? '#f6ad55' : '#48bb78'}; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold;">${idx + 1}</span>
                                            <span style="font-weight: bold; color: #2d3748;">${idx === 0 ? 'Ưu tiên cao' : idx === 1 ? 'Ưu tiên trung bình' : 'Ưu tiên thấp'}</span>
                                        </div>
                                        <div style="margin-left: 45px; color: #4a5568;">${solution}</div>
                                    </div>
                                `).join('') : 'Cần tham khảo chuyên gia'}
                            </div>
                        </div>
                        
                        <div style="background: #e6fffa; padding: 20px; border-radius: 15px; border-left: 5px solid #38b2ac;">
                            <h4 style="color: #234e52; margin-bottom: 15px;">💡 Lưu Ý Quan Trọng:</h4>
                            <ul style="color: #285e61; margin-left: 20px;">
                                <li>Luôn backup dữ liệu trước khi sửa chữa</li>
                                <li>Sử dụng linh kiện chính hãng hoặc tương thích</li>
                                <li>Kiểm tra bảo hành trước khi can thiệp</li>
                                <li>Nếu không chắc chắn, hãy tham khảo chuyên gia</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Click outside to close
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Hiển thị các bước chẩn đoán
        function showDiagnosticSteps(errorKey) {
            const errorData = errorDatabase[errorKey];
            if (!errorData || !errorData.diagnosis) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; max-width: 700px; max-height: 90vh; overflow-y: auto; position: relative;">
                    <div style="background: linear-gradient(135deg, #4299e1, #3182ce); color: white; padding: 25px; border-radius: 20px 20px 0 0;">
                        <h2 style="margin: 0;">🔬 Quy Trình Chẩn Đoán</h2>
                        <h3 style="margin: 10px 0 0 0; opacity: 0.9;">${errorData.vietnameseName}</h3>
                        <button onclick="this.closest('.modal').remove()" style="position: absolute; top: 15px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; border-radius: 50%; width: 40px; height: 40px;">×</button>
                    </div>
                    <div style="padding: 30px;">
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">🎯 Mục Tiêu Chẩn Đoán:</h4>
                            <div style="background: #e6fffa; padding: 15px; border-radius: 10px; color: #234e52;">
                                Xác định chính xác nguyên nhân gây ra lỗi <strong>${errorData.vietnameseName}</strong> và đưa ra phương án sửa chữa phù hợp.
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">📋 Các Bước Chẩn Đoán Chi Tiết:</h4>
                            ${Object.entries(errorData.diagnosis).map(([step, description], idx) => `
                                <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #f7fafc, #edf2f7); border-radius: 15px; border-left: 5px solid #4299e1;">
                                    <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                        <div style="background: #4299e1; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; font-size: 1.1em;">${idx + 1}</div>
                                        <h5 style="color: #2d3748; margin: 0; text-transform: capitalize;">${step.replace('step', 'Bước ')}</h5>
                                    </div>
                                    <div style="margin-left: 55px; color: #4a5568; font-size: 1.05em;">${description}</div>
                                    <div style="margin: 15px 0 0 55px;">
                                        <div style="background: white; padding: 10px 15px; border-radius: 8px; border: 1px solid #e2e8f0; font-size: 0.9em; color: #666;">
                                            💡 <strong>Mẹo:</strong> ${getDiagnosticTip(step, errorKey)}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="background: #fff5f5; padding: 20px; border-radius: 15px; border-left: 5px solid #f56565;">
                            <h4 style="color: #742a2a; margin-bottom: 15px;">⚠️ Lưu Ý An Toàn:</h4>
                            <ul style="color: #742a2a; margin-left: 20px;">
                                <li>Tắt nguồn thiết bị trước khi kiểm tra phần cứng</li>
                                <li>Sử dụng thiết bị đo lường chính xác</li>
                                <li>Ghi lại tất cả kết quả đo để so sánh</li>
                                <li>Không thực hiện nếu thiếu kinh nghiệm</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Click outside to close
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Lấy mẹo chẩn đoán cho từng bước
        function getDiagnosticTip(step, errorKey) {
            const tips = {
                'step1': 'Sử dụng multimeter chính xác và kiểm tra ở nhiều điều kiện khác nhau',
                'step2': 'So sánh với thiết bị tương tự để xác định sự khác biệt',
                'step3': 'Ghi lại tất cả giá trị đo được để phân tích sau',
                'step4': 'Kiểm tra cả trong điều kiện bình thường và stress test'
            };
            return tips[step] || 'Thực hiện cẩn thận và ghi lại kết quả';
        }

        // Hiển thị chẩn đoán tổng quát
        function showGeneralDiagnostic() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative;">
                    <div style="background: linear-gradient(135deg, #38a169, #48bb78); color: white; padding: 25px; border-radius: 20px 20px 0 0;">
                        <h2 style="margin: 0;">🔍 Chẩn Đoán Tổng Quát</h2>
                        <button onclick="this.closest('.modal').remove()" style="position: absolute; top: 15px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; border-radius: 50%; width: 40px; height: 40px;">×</button>
                    </div>
                    <div style="padding: 30px;">
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">📋 Checklist Chẩn Đoán Cơ Bản:</h4>
                            <div style="space-y: 10px;">
                                ${[
                                    'Kiểm tra phiên bản iOS và update log',
                                    'Xem lại các app được cài đặt gần đây',
                                    'Kiểm tra dung lượng lưu trữ còn lại',
                                    'Test ở Safe Mode (nếu có jailbreak)',
                                    'Kiểm tra nhiệt độ thiết bị',
                                    'Test với factory reset (backup trước)',
                                    'Kiểm tra phần cứng cơ bản (màn hình, cảm ứng, âm thanh)',
                                    'Chạy Apple Diagnostics nếu có thể'
                                ].map((item, idx) => `
                                    <label style="display: flex; align-items: center; padding: 12px; background: #f7fafc; border-radius: 8px; margin: 8px 0; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#edf2f7'" onmouseout="this.style.background='#f7fafc'">
                                        <input type="checkbox" style="margin-right: 12px; transform: scale(1.2);">
                                        <span style="color: #4a5568;">${item}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="background: #e6fffa; padding: 20px; border-radius: 15px;">
                            <h4 style="color: #234e52; margin-bottom: 15px;">💡 Khuyến Nghị:</h4>
                            <p style="color: #285e61; line-height: 1.6;">
                                Nếu không tìm thấy lỗi cụ thể trong panic log, có thể đây là lỗi phần mềm tạm thời. 
                                Hãy thực hiện các bước chẩn đoán cơ bản trên và theo dõi thiết bị trong vài ngày tới.
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Click outside to close
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Cập nhật số lượng file text
        function updateTextFileCount() {
            const textCount = analysisResults.filter(r => !r.filename.includes('AI Vision')).length;
            document.getElementById('textFiles').textContent = textCount;
        }

        // Cập nhật số lượng file ảnh
        function updateImageFileCount() {
            const imageCount = analysisResults.filter(r => r.filename.includes('AI Vision')).length;
            document.getElementById('imageFiles').textContent = imageCount;
        }

        // Cập nhật độ chính xác AI
        function updateAIAccuracy() {
            const aiResults = analysisResults.filter(r => r.filename.includes('AI Vision'));
            if (aiResults.length > 0) {
                const avgConfidence = aiResults.reduce((sum, result) => {
                    const avgErrorConfidence = result.errors.length > 0 
                        ? result.errors.reduce((s, e) => s + e.confidence, 0) / result.errors.length
                        : 85;
                    return sum + avgErrorConfidence;
                }, 0) / aiResults.length;
                
                document.getElementById('aiAccuracy').textContent = Math.round(avgConfidence) + '%';
            }
        }

        // Cập nhật số lượng lỗi
        function updateErrorCounts() {
            const totalErrors = analysisResults.reduce((sum, result) => sum + result.errors.length, 0);
            document.getElementById('textErrors').textContent = totalErrors;
        }

        // Hiển thị database lỗi
        function displayErrorDatabase() {
            const container = document.getElementById('errorDatabase');
            container.innerHTML = '';
            
            const filteredErrors = Object.entries(errorDatabase).filter(([key, data]) => {
                if (currentFilter === 'all') return true;
                return data.category === currentFilter;
            });
            
            filteredErrors.forEach(([key, data]) => {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-item';
                errorDiv.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">
                        <span class="severity-indicator severity-${data.severity}"></span>
                        ${data.vietnameseName}
                    </div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                        Danh mục: ${getCategoryText(data.category)} | Mức độ: ${getSeverityText(data.severity)}
                    </div>
                    <div style="font-size: 0.9em; color: #555;">
                        ${data.description}
                    </div>
                    <div style="font-size: 0.8em; color: #888; margin-top: 8px;">
                        Patterns: ${data.patterns.join(', ')}
                    </div>
                `;
                
                errorDiv.addEventListener('click', () => {
                    // Highlight selected error
                    document.querySelectorAll('.error-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    errorDiv.classList.add('selected');
                });
                
                container.appendChild(errorDiv);
            });
        }

        // Lấy text danh mục
        function getCategoryText(category) {
            const categoryMap = {
                'hardware': 'Phần cứng',
                'software': 'Phần mềm',
                'thermal': 'Nhiệt độ',
                'power': 'Nguồn',
                'memory': 'Bộ nhớ',
                'sensor': 'Cảm biến'
            };
            return categoryMap[category] || category;
        }

        // Lọc theo danh mục
        function filterByCategory(category) {
            currentFilter = category;
            
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayErrorDatabase();
        }

        // Xử lý tìm kiếm
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const errorItems = document.querySelectorAll('.error-item');
            
            errorItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                    // Highlight search term
                    if (searchTerm) {
                        item.style.background = 'linear-gradient(135deg, #fff5f5, #fed7d7)';
                    } else {
                        item.style.background = '';
                    }
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Hiển thị thông báo thành công
        function showSuccessNotification(message) {
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.background = 'linear-gradient(135deg, #48bb78, #68d391)';
            notification.style.color = 'white';
            notification.style.padding = '15px 25px';
            notification.style.borderRadius = '25px';
            notification.style.boxShadow = '0 15px 30px rgba(72, 187, 120, 0.4)';
            notification.style.zIndex = '10000';
            notification.style.animation = 'slideInRight 0.5s ease';
            notification.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <span style="font-size: 1.2em; margin-right: 10px;">✅</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }

        // Scroll to top
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Export functionality
        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                totalFiles: analysisResults.length,
                totalErrors: analysisResults.reduce((sum, result) => sum + result.errors.length, 0),
                results: analysisResults.map(result => ({
                    filename: result.filename,
                    errors: result.errors.map(error => ({
                        name: error.data.vietnameseName,
                        severity: error.data.severity,
                        confidence: error.confidence,
                        description: error.data.description
                    })),
                    timestamp: result.timestamp
                }))
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `panic_log_analysis_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccessNotification('Kết quả đã được xuất thành công!');
        }

        // Auto-save functionality
        function autoSaveResults() {
            if (analysisResults.length > 0) {
                localStorage.setItem('panicLogAnalysis', JSON.stringify({
                    timestamp: new Date().toISOString(),
                    results: analysisResults
                }));
            }
        }

        // Load saved results
        function loadSavedResults() {
            const saved = localStorage.getItem('panicLogAnalysis');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    const timeDiff = new Date() - new Date(data.timestamp);
                    
                    // Chỉ load nếu dữ liệu không quá 24h
                    if (timeDiff < 24 * 60 * 60 * 1000) {
                        analysisResults = data.results;
                        displayAnalysisResults();
                        updateTextFileCount();
                        updateImageFileCount();
                        updateAIAccuracy();
                        updateErrorCounts();
                        showSuccessNotification('Đã khôi phục phiên làm việc trước!');
                    }
                } catch (e) {
                    console.error('Lỗi khi load dữ liệu đã lưu:', e);
                }
            }
        }

        // Thêm các animation effects
        function addAdvancedEffects() {
            // Thêm CSS animation cho particles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes float {
                    0%, 100% { 
                        transform: translateY(0px) rotate(0deg); 
                        opacity: 0.7;
                    }
                    50% { 
                        transform: translateY(-20px) rotate(180deg); 
                        opacity: 1;
                    }
                }
                
                               @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(30px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
                
                .fade-in {
                    animation: fadeIn 0.6s ease-out;
                }
                
                .scan-line {
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.3), transparent);
                    animation: scanEffect 2s infinite;
                }
                
                @keyframes scanEffect {
                    0% { left: -100%; }
                    100% { left: 100%; }
                }
                
                .error-item.selected {
                    background: linear-gradient(135deg, #e6fffa, #b2f5ea) !important;
                    border-left: 5px solid #38b2ac !important;
                    transform: translateX(10px) !important;
                }
                
                .floating-particles {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: -1;
                }
                
                .particle {
                    position: absolute;
                    background: rgba(102, 126, 234, 0.1);
                    border-radius: 50%;
                    animation: float 6s ease-in-out infinite;
                }
            `;
            document.head.appendChild(style);
            
            // Tạo floating particles
            createFloatingParticles();
        }

        // Tạo floating particles
        function createFloatingParticles() {
            const particlesContainer = document.createElement('div');
            particlesContainer.className = 'floating-particles';
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = (Math.random() * 10 + 5) + 'px';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                particlesContainer.appendChild(particle);
            }
            
            document.body.appendChild(particlesContainer);
        }

        // Xuất báo cáo chi tiết
        function exportDetailedReport() {
            const allErrors = analysisResults.flatMap(result => result.errors);
            const severityStats = {};
            const componentStats = {};
            
            allErrors.forEach(error => {
                severityStats[error.data.severity] = (severityStats[error.data.severity] || 0) + 1;
                componentStats[error.data.component] = (componentStats[error.data.component] || 0) + 1;
            });
            
            const report = {
                metadata: {
                    generatedAt: new Date().toISOString(),
                    generatedBy: 'AI Vision Pro Panic Log Analyzer',
                    version: '2.0.0',
                    totalFiles: analysisResults.length,
                    totalErrors: allErrors.length,
                    avgConfidence: allErrors.length > 0 ? Math.round(allErrors.reduce((sum, e) => sum + e.confidence, 0) / allErrors.length) : 0
                },
                summary: {
                    severityBreakdown: severityStats,
                    topComponents: Object.entries(componentStats)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 5)
                        .map(([component, count]) => ({ component, count })),
                    recommendations: generateRecommendations(allErrors)
                },
                detailedResults: analysisResults.map(result => ({
                    filename: result.filename,
                    timestamp: result.timestamp,
                    errorCount: result.errors.length,
                    errors: result.errors.map(error => ({
                        vietnameseName: error.data.vietnameseName,
                        englishName: error.key,
                        severity: error.data.severity,
                        confidence: error.confidence,
                        category: error.data.category,
                        component: error.data.component,
                        location: error.data.location,
                        description: error.data.description,
                        symptoms: error.data.symptoms,
                        causes: error.data.causes,
                        repairSolutions: error.data.repairSolution,
                        context: error.context?.substring(0, 200) + '...'
                    }))
                }))
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `detailed_panic_analysis_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccessNotification('Báo cáo chi tiết đã được xuất!');
        }

        // Tạo khuyến nghị
        function generateRecommendations(errors) {
            const recommendations = [];
            const criticalCount = errors.filter(e => e.data.severity === 'critical').length;
            const highCount = errors.filter(e => e.data.severity === 'high').length;
            
            if (criticalCount > 0) {
                recommendations.push({
                    priority: 'URGENT',
                    message: `Có ${criticalCount} lỗi nghiêm trọng cần sửa chữa ngay lập tức để tránh hư hỏng thêm.`,
                    action: 'Liên hệ chuyên gia sửa chữa trong 24h'
                });
            }
            
            if (highCount > 2) {
                recommendations.push({
                    priority: 'HIGH',
                    message: `Nhiều lỗi mức cao (${highCount}) cho thấy thiết bị đang có vấn đề hệ thống.`,
                    action: 'Backup dữ liệu và lên kế hoạch sửa chữa trong tuần'
                });
            }
            
            const thermalErrors = errors.filter(e => e.data.category === 'thermal').length;
            if (thermalErrors > 0) {
                recommendations.push({
                    priority: 'MEDIUM',
                    message: `Phát hiện ${thermalErrors} lỗi liên quan đến nhiệt độ.`,
                    action: 'Kiểm tra hệ thống tản nhiệt và vệ sinh thiết bị'
                });
            }
            
            return recommendations;
        }

        // Hiển thị hướng dẫn ưu tiên sửa chữa
        function showRepairPriorityGuide() {
            const allErrors = analysisResults.flatMap(result => result.errors);
            const criticalErrors = allErrors.filter(e => e.data.severity === 'critical');
            const highErrors = allErrors.filter(e => e.data.severity === 'high');
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; max-width: 800px; max-height: 90vh; overflow-y: auto; position: relative;">
                    <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 25px; border-radius: 20px 20px 0 0;">
                        <h2 style="margin: 0;">🛠️ Hướng Dẫn Ưu Tiên Sửa Chữa</h2>
                        <p style="margin: 10px 0 0 0; opacity: 0.9;">Dựa trên ${allErrors.length} lỗi được phát hiện</p>
                        <button onclick="this.closest('.modal').remove()" style="position: absolute; top: 15px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; border-radius: 50%; width: 40px; height: 40px;">×</button>
                    </div>
                    <div style="padding: 30px;">
                        ${criticalErrors.length > 0 ? `
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #e53e3e; margin-bottom: 20px; display: flex; align-items: center;">
                                    🚨 KHẨN CẤP - Sửa ngay (${criticalErrors.length} lỗi)
                                </h3>
                                ${criticalErrors.map((error, idx) => `
                                    <div style="margin: 15px 0; padding: 20px; background: #fff5f5; border-left: 5px solid #e53e3e; border-radius: 10px;">
                                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                                            <h4 style="color: #e53e3e; margin: 0;">${idx + 1}. ${error.data.vietnameseName}</h4>
                                            <span style="background: #e53e3e; color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.9em;">${error.confidence}% tin cậy</span>
                                        </div>
                                        <div style="color: #4a5568; margin-bottom: 10px;"><strong>Linh kiện:</strong> ${error.data.component}</div>
                                        <div style="color: #4a5568; margin-bottom: 15px;"><strong>Tác động:</strong> ${error.data.description}</div>
                                        <div style="background: white; padding: 15px; border-radius: 8px;">
                                            <strong style="color: #e53e3e;">Hành động ngay:</strong>
                                            <ul style="margin: 10px 0 0 20px; color: #4a5568;">
                                                ${error.data.repairSolution ? error.data.repairSolution.slice(0, 2).map(solution => `<li>${solution}</li>`).join('') : '<li>Cần chẩn đoán chuyên sâu</li>'}
                                            </ul>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        ${highErrors.length > 0 ? `
                            <div style="margin-bottom: 30px;">
                                <h3 style="color: #f6ad55; margin-bottom: 20px; display: flex; align-items: center;">
                                    ⚠️ MỨC CAO - Sửa trong tuần (${highErrors.length} lỗi)
                                </h3>
                                ${highErrors.slice(0, 3).map((error, idx) => `
                                    <div style="margin: 15px 0; padding: 20px; background: #fffbf0; border-left: 5px solid #f6ad55; border-radius: 10px;">
                                        <h4 style="color: #c05621; margin: 0 0 10px 0;">${idx + 1}. ${error.data.vietnameseName}</h4>
                                        <div style="color: #4a5568; margin-bottom: 10px;">${error.data.description}</div>
                                        <div style="color: #c05621; font-size: 0.9em;">📍 ${error.data.component}</div>
                                    </div>
                                `).join('')}
                                ${highErrors.length > 3 ? `<div style="text-align: center; color: #666; font-style: italic;">... và ${highErrors.length - 3} lỗi mức cao khác</div>` : ''}
                            </div>
                        ` : ''}
                        
                        <div style="background: #f0fff4; padding: 25px; border-radius: 15px; border-left: 5px solid #38a169;">
                            <h3 style="color: #38a169; margin: 0 0 15px 0;">✅ Kế Hoạch Hành Động Tổng Thể</h3>
                            <div style="color: #2f855a;">
                                <div style="margin: 10px 0;"><strong>1. Ngay lập tức:</strong> Backup toàn bộ dữ liệu quan trọng</div>
                                <div style="margin: 10px 0;"><strong>2. Trong 24h:</strong> Xử lý tất cả lỗi nghiêm trọng</div>
                                <div style="margin: 10px 0;"><strong>3. Trong tuần:</strong> Sửa chữa lỗi mức cao</div>
                                <div style="margin: 10px 0;"><strong>4. Theo dõi:</strong> Monitor thiết bị sau sửa chữa</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Hiển thị ước tính chi phí
        function showCostEstimate() {
            const allErrors = analysisResults.flatMap(result => result.errors);
            const costEstimates = {
                'watchdog_timeout': { min: 500000, max: 2000000, component: 'Main Logic Board' },
                'thermal_shutdown': { min: 200000, max: 800000, component: 'Thermal System' },
                'battery_panic': { min: 300000, max: 1200000, component: 'Battery + Charging IC' },
                'memory_panic': { min: 800000, max: 3000000, component: 'RAM Module' },
                'nand_panic': { min: 1000000, max: 4000000, component: 'Storage + Controller' },
                'camera_panic': { min: 400000, max: 1500000, component: 'Camera Module' },
                'touch_panic': { min: 600000, max: 2500000, component: 'Touch IC + Display' },
                'wifi_panic': { min: 300000, max: 1000000, component: 'WiFi Chip' },
                'pmu_panic': { min: 700000, max: 2500000, component: 'PMU IC' },
                'secure_enclave_panic': { min: 1500000, max: 5000000, component: 'Logic Board Replacement' }
            };
            
            let totalMinCost = 0;
            let totalMaxCost = 0;
            const repairItems = [];
            
            allErrors.forEach(error => {
                const cost = costEstimates[error.key];
                if (cost) {
                    totalMinCost += cost.min;
                    totalMaxCost += cost.max;
                    repairItems.push({
                        name: error.data.vietnameseName,
                        component: cost.component,
                        minCost: cost.min,
                        maxCost: cost.max,
                        severity: error.data.severity
                    });
                }
            });
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; max-width: 700px; max-height: 90vh; overflow-y: auto; position: relative;">
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 20px 20px 0 0;">
                        <h2 style="margin: 0;">💰 Ước Tính Chi Phí Sửa Chữa</h2>
                        <p style="margin: 10px 0 0 0; opacity: 0.9;">Dựa trên ${repairItems.length} lỗi cần sửa chữa</p>
                        <button onclick="this.closest('.modal').remove()" style="position: absolute; top: 15px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; font-size: 24px; cursor: pointer; border-radius: 50%; width: 40px; height: 40px;">×</button>
                    </div>
                    <div style="padding: 30px;">
                        <div style="text-align: center; margin-bottom: 30px; padding: 25px; background: linear-gradient(135deg, #f7fafc, #edf2f7); border-radius: 15px;">
                            <h3 style="color: #2d3748; margin: 0 0 15px 0;">Tổng Chi Phí Ước Tính</h3>
                            <div style="font-size: 2em; font-weight: bold; color: #667eea; margin-bottom: 10px;">
                                ${(totalMinCost / 1000).toLocaleString('vi-VN')}K - ${(totalMaxCost / 1000).toLocaleString('vi-VN')}K VNĐ
                            </div>
                            <div style="color: #666; font-size: 0.95em;">
                                (Chưa bao gồm phí công và kiểm tra)
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #2d3748; margin-bottom: 15px;">📋 Chi Tiết Từng Hạng Mục:</h4>
                            ${repairItems.map((item, idx) => `
                                <div style="margin: 15px 0; padding: 20px; background: ${item.severity === 'critical' ? '#fff5f5' : item.severity === 'high' ? '#fffbf0' : '#f7fafc'}; border-left: 5px solid ${getSeverityColor(item.severity)}; border-radius: 10px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <h5 style="color: #2d3748; margin: 0;">${idx + 1}. ${item.name}</h5>
                                        <span style="background: ${getSeverityColor(item.severity)}; color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.8em;">${getSeverityText(item.severity)}</span>
                                    </div>
                                    <div style="color: #4a5568; margin-bottom: 10px;">🔧 Linh kiện: ${item.component}</div>
                                    <div style="color: #2d3748; font-weight: bold;">
                                        💰 Chi phí: ${(item.minCost / 1000).toLocaleString('vi-VN')}K - ${(item.maxCost / 1000).toLocaleString('vi-VN')}K VNĐ
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="background: #e6fffa; padding: 20px; border-radius: 15px; border-left: 5px solid #38b2ac;">
                            <h4 style="color: #234e52; margin: 0 0 15px 0;">💡 Lưu Ý Về Chi Phí:</h4>
                            <ul style="color: #285e61; margin-left: 20px; line-height: 1.6;">
                                <li>Giá chỉ mang tính chất tham khảo, có thể thay đổi theo từng cửa hàng</li>
                                <li>Chi phí công sửa chữa: 100K - 500K VNĐ tùy độ phức tạp</li>
                                <li>Nên so sánh giá ở nhiều nơi trước khi quyết định</li>
                                <li>Ưu tiên sửa chữa lỗi nghiêm trọng trước để tránh hỏng lan</li>
                                <li>Kiểm tra bảo hành trước khi sửa chữa</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center; margin-top: 25px;">
                            <button onclick="exportCostReport()" style="background: linear-gradient(135deg, #48bb78, #38a169); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; margin: 0 10px;">
                                📊 Xuất Báo Cáo Chi Phí
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Xuất báo cáo chi phí
        function exportCostReport() {
            const allErrors = analysisResults.flatMap(result => result.errors);
            const costEstimates = {
                'watchdog_timeout': { min: 500000, max: 2000000, component: 'Main Logic Board' },
                'thermal_shutdown': { min: 200000, max: 800000, component: 'Thermal System' },
                'battery_panic': { min: 300000, max: 1200000, component: 'Battery + Charging IC' },
                'memory_panic': { min: 800000, max: 3000000, component: 'RAM Module' },
                'nand_panic': { min: 1000000, max: 4000000, component: 'Storage + Controller' },
                'camera_panic': { min: 400000, max: 1500000, component: 'Camera Module' },
                'touch_panic': { min: 600000, max: 2500000, component: 'Touch IC + Display' },
                'wifi_panic': { min: 300000, max: 1000000, component: 'WiFi Chip' },
                'pmu_panic': { min: 700000, max: 2500000, component: 'PMU IC' },
                'secure_enclave_panic': { min: 1500000, max: 5000000, component: 'Logic Board Replacement' }
            };
            
            const costReport = {
                generatedAt: new Date().toISOString(),
                deviceAnalysis: 'iOS Panic Log Cost Estimate',
                totalErrors: allErrors.length,
                repairItems: [],
                summary: {
                    totalMinCost: 0,
                    totalMaxCost: 0,
                    currency: 'VND',
                    note: 'Chi phí chưa bao gồm phí công và kiểm tra'
                }
            };
            
            allErrors.forEach(error => {
                const cost = costEstimates[error.key];
                if (cost) {
                    costReport.repairItems.push({
                        errorName: error.data.vietnameseName,
                        component: cost.component,
                        severity: error.data.severity,
                        confidence: error.confidence,
                        minCost: cost.min,
                        maxCost: cost.max,
                        priority: error.data.severity === 'critical' ? 1 : error.data.severity === 'high' ? 2 : 3
                    });
                    costReport.summary.totalMinCost += cost.min;
                    costReport.summary.totalMaxCost += cost.max;
                }
            });
            
            // Sort by priority
            costReport.repairItems.sort((a, b) => a.priority - b.priority);
            
            const blob = new Blob([JSON.stringify(costReport, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cost_estimate_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccessNotification('Báo cáo chi phí đã được xuất!');
        }

        // Thêm floating action button
        const floatingBtn = document.createElement('button');
        floatingBtn.className = 'floating-action';
        floatingBtn.innerHTML = '↑';
        floatingBtn.title = 'Scroll to top';
        floatingBtn.onclick = scrollToTop;
        document.body.appendChild(floatingBtn);

        // Ẩn/hiện floating button khi scroll
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                floatingBtn.style.display = 'block';
            } else {
                floatingBtn.style.display = 'none';
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        autoSaveResults();
                        showSuccessNotification('Đã lưu kết quả!');
                        break;
                    case 'e':
                        e.preventDefault();
                        if (analysisResults.length > 0) {
                            exportDetailedReport();
                        }
                        break;
                    case 'f':
                        e.preventDefault();
                        document.getElementById('searchBox').focus();
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => modal.remove());
            }
        });

        // Performance monitoring
        if ('performance' in window) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    console.log(`🚀 Trang load trong ${Math.round(perfData.loadEventEnd - perfData.loadEventStart)}ms`);
                }, 0);
            });
        }

        // Service Worker registration (for offline capability)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('✅ Service Worker đã đăng ký');
                    })
                    .catch(error => {
                        console.log('❌ Service Worker đăng ký thất bại');
                    });
            });
        }

        console.log('🤖 AI Vision Pro Panic Log Analyzer đã sẵn sàng!');
        console.log('📊 Database: 100+ lỗi iOS được hỗ trợ');
        console.log('👁️ AI Vision: Computer Vision + OCR Engine');
        console.log('⚡ Performance: Optimized for speed and accuracy');

        // Xóa tất cả lịch sử
function clearAllHistory() {
    if (confirm('🗑️ Bạn có chắc chắn muốn xóa tất cả lịch sử phân tích?\n\nHành động này không thể hoàn tác!')) {
        // Xóa dữ liệu trong bộ nhớ
        analysisResults = [];
        
        // Xóa localStorage
        localStorage.removeItem('panicLogAnalysis');
        
        // Ẩn container kết quả
        document.getElementById('resultsContainer').style.display = 'none';
        
        // Reset counters
        document.getElementById('textFiles').textContent = '0';
        document.getElementById('imageFiles').textContent = '0';
        document.getElementById('textErrors').textContent = '0';
        document.getElementById('aiAccuracy').textContent = '0%';
        
        // Xóa preview ảnh nếu có
        const existingPreview = document.querySelector('.image-preview, div[style*="position: relative"]');
        if (existingPreview) {
            existingPreview.remove();
        }
        
        // Hiển thị thông báo
        showSuccessNotification('🗑️ Đã xóa tất cả lịch sử thành công!');
        
        console.log('✅ Lịch sử đã được xóa hoàn toàn');
    }
}

    </script>
</body>
</html>
